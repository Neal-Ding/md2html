<h1 id="c01">服务窗简介</h1>
<h2 id="c0101">服务窗平台开发接口介绍</h2>
<h3 id="c0101_intro">概述</h3>
<p>服务窗平台是为支付宝用户提供服务的平台，平台开发接口是提供服务的基础。开发者在<a href="https://fuwu.alipay.com/platform/index.htm">服务窗平台</a>中创建服务窗，并且申请接口权限之后，可以通过阅读该文档来完成服务窗的开发工作。</p>
<p>服务窗平台开发接口向开发者提供包括自定义菜单、消息交互、获取用户基础信息等能力。当用户发消息给服务窗或者与服务窗发生其他交互时，支付宝网关会使用HTTP请求将消息推送给开发者网关，开发者网关也可以通过异步调用的方式给用户发送消息。</p>
<p>如果您发现文档中存在错误，或者您对该文档有任何建议，欢迎提出反馈：寒墨 <a href="&#109;&#x61;&#105;&#108;&#116;&#111;&#58;&#104;&#97;&#110;&#x6d;&#x6f;&#46;&#x68;&#x74;&#x66;&#64;&#x61;&#x6c;&#105;&#x62;&#97;&#x62;&#97;&#x2d;&#x69;&#x6e;&#99;&#x2e;&#99;&#x6f;&#x6d;">&#104;&#97;&#110;&#x6d;&#x6f;&#46;&#x68;&#x74;&#x66;&#64;&#x61;&#x6c;&#105;&#x62;&#97;&#x62;&#97;&#x2d;&#x69;&#x6e;&#99;&#x2e;&#99;&#x6f;&#x6d;</a></p>
<h3 id="c0101_apis">接口能力</h3>
<p>服务窗平台目前支持以下接口能力：</p>
<table>
<thead>
<tr>
<th>接口能力</th>
<th>描述及应用场景举例</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#c03">接收用户消息</a></td>
<td>用户发送的消息或者与服务窗产生的交互都会被推送至开发者网关，配合消息推送接口，开发者可以实现关键词回复消息、客服等业务</td>
</tr>
<tr>
<td><a href="#c04">向用户推送消息</a></td>
<td>开发者可以使用<a href="#c0401">异步单发消息</a>接口或者<a href="#c0402">群发消息</a>接口向用户推送消息</td>
</tr>
<tr>
<td><a href="#c0502">获取用户地理位置信息</a></td>
<td>开发者可以根据用户地理位置信息提供个性化服务</td>
</tr>
<tr>
<td><a href="#c0503">网页授权获取用户基本信息</a></td>
<td>开发者可以通过OAuth2.0鉴权的方式获取用户基本信息，实现账号绑定、免登等业务逻辑</td>
</tr>
<tr>
<td><a href="#c06">自定义菜单</a></td>
<td>支持<a href="#c0602">创建菜单</a>、<a href="#c0603">更新菜单</a>、<a href="#c0604">查询菜单</a>，用户点击菜单可以向开发者推送消息或者打开Web页面</td>
</tr>
<tr>
<td><a href="#c0801">支付接口</a></td>
<td>开发者可以在Web页面调用支付接口，非常方便地实现支付功能</td>
</tr>
<tr>
<td><a href="#c10">JS接口</a></td>
<td>开发者可以在Web页面调用JS接口实现获取用户网络状况、摇一摇等功能</td>
</tr>
</tbody>
</table>
<h2 id="c0102">成功案例介绍</h2>
<h3 id="c0102_shihua">中国石化浙江石油掌上营业厅</h3>
<p>中石化服务窗可以将用户与自身石化会员体系绑定，在此基础之上，为会员提供在线办卡、办卡进度查询、在线充值、消费查询等一系列服务。用户只需要关注该服务窗便可以享受这些快捷优质的服务。</p>
<p><img src="https://i.alipayobjects.com/i/ecmng/png/201406/2uuFfyeCzd_src.png" alt="中国石化浙江石油掌上营业厅"></p>
<h3 id="c0102_buding">布丁酒店连锁</h3>
<p>用户可以通过布丁酒店连锁服务窗进行账户绑定，使用该服务窗完成酒店预订、订单与积分管理、优惠券与特权券查看等功能，从此告别繁琐的APP，一步完成所需。用户还可以在这些服务中方便地使用支付宝的支付功能，安全快捷。除此之外，用户还能享受布丁酒店推送的优惠活动哦~</p>
<p><img src="https://i.alipayobjects.com/i/ecmng/png/201406/2uuEu83RE5_src.png" alt="布丁酒店连锁"></p>
<h3 id="c0102_zhongxin">中信银行信用卡</h3>
<p>如果你是持卡人，可快捷查询信用卡账单、额度及积分。你还可以在服务窗中实现快速还款、申请账单分期等功能。从此你的信用卡消费将更加易于追踪，及时的消息推送让你再也不会忘记信用卡还款。</p>
<p><img src="https://i.alipayobjects.com/i/ecmng/png/201406/2uuGFImIKr_src.png" alt="中信银行信用卡"></p>
<h3 id="c0102_dianxin">中国电信</h3>
<p>用户可以在中国电信服务窗中绑定自己的手机，从此话费和流量查询以及充值将变得异常简单。除此之外，用户还能第一时间看到中国电信推送的一系列优惠活动。</p>
<p><img src="https://i.alipayobjects.com/i/ecmng/png/201406/2uuFzux8xB_src.png" alt="中国电信"></p>
<h3 id="c0102_weizhang">交通违章办理</h3>
<p>在我们身处异地办理违章缴款并不方便、或是时间不充裕的时候，选择支付宝钱包代办交通违章无疑非常方便，万事不求人，填写完车牌号、发动机号等资料后就可以对车辆的违章情况进行查询，如果我们对违章情况没有异议的话可以直接在这里缴纳违章费用。</p>
<p><img src="https://i.alipayobjects.com/i/ecmng/png/201406/2uuHMOCNdd_src.png" alt="交通违章办理"></p>
<h2 id="c0103">开发者规范</h2>
<p>开发者进行服务窗开发时，除了需要满足每个接口的规范限制、调用频率限制外，还需特别注意用户数据等敏感信息的使用规范。</p>
<h3 id="c0103_data">用户数据获取使用规范</h3>
<ol>
<li>您的服务需要收集用户任何数据的，必须事先获得用户的明确同意，并且只使用运营中必须的用户数据，同时应当告知用户相关数据收集的目的、范围及使用方式等，保障用户知情权。</li>
<li>您收集用户的数据后，必须采取必要的保护措施，防止用户数据被盗、泄漏等。</li>
<li>您在特定支付宝服务窗中收集的用户数据仅可以在该特定支付宝服务窗中使用，不得将其使用在该特定支付宝服务窗之外或为其他任何目的进行使用，也不得以任何方式将其提供给他人。</li>
<li>如果支付宝认为您收集、使用用户数据的方式，可能损害用户体验，支付宝有权要求您删除相关数据并不得再以该方式收集、使用用户数据。</li>
<li>一旦您停止该服务，或支付宝基于任何原因终止您使用本服务，您必须立即删除全部因使用本服务而获得的数据（包括各种备份）， 且不得再以任何方式进行使用。</li>
</ol>
<h3 id="c0103_others">其他规范</h3>
<ol>
<li>请勿为任何用户自动登录到支付宝服务窗平台提供代理身份验证凭据。</li>
<li>请勿提供跟踪功能，包括但不限于识别其他用户在个人主页上查看、点击等操作行为。</li>
<li>请勿自动将浏览器窗口定向到其他网页。</li>
<li>请勿设置或发布任何违反相关法规、公序良俗、社会公德等的玩法、内容等。</li>
<li>请勿公开表达或暗示，您与支付宝之间存在合作关系，包括但不限于相互持股、商业往来或合作关系等，或声称支付宝对您的认可。</li>
</ol>
<h1 id="c02">安全基础与接入</h1>
<h2 id="c0201">安全基础 - 生成公钥、私钥</h2>
<h3 id="c0201_intro">概述</h3>
<p>服务窗平台采用了RSA加密签名的安全通信机制，开发者可以通过支付宝的公钥验证消息的来源，同时使用自己的私钥进行信息加密。RSA算法及数字签名机制是服务窗平台与开发者网关安全通信的基础，如果开发者对RSA及数字签名并不熟悉，请先查阅相关资料。</p>
<h3 id="c0201_rsa">RSA密钥使用指南</h3>
<h4 id="c0201_openssl">OpenSSL工具安装</h4>
<ol>
<li><p>Linux用户（以Ubuntu为例）</p>
<pre><code> sudo apt-get install openssl
</code></pre></li>
<li><p>Windows用户开发者可以在<a href="https://www.openssl.org/related/binaries.html">OpenSSL官方网站</a>下载Windows的OpenSSL安装包进行安装</p>
</li>
</ol>
<h4 id="c0201_rsa_gen">RSA私钥及公钥生成</h4>
<ol>
<li><p>Linux用户（以Ubuntu为例）</p>
<pre><code> $ openssl   进入OpenSSL程序
 OpenSSL&gt; genrsa -out rsa_private_key.pem 1024   生成私钥
 OpenSSL&gt; pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM -nocrypt     将私钥转换成PKCS8格式
 OpenSSL&gt; rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem    生成公钥
 OpenSSL&gt; exit   ## 退出OpenSSL程序
</code></pre></li>
<li><p>Windows用户
以下操作在cmd窗口使用</p>
<pre><code> C:\Users\Hammer&gt;cd C:\OpenSSL-Win32\bin     进入OpenSSL安装目录
 C:\OpenSSL-Win32\bin&gt;openssl.exe            进入OpenSSL程序
 OpenSSL&gt; genrsa -out rsa_private_key.pem 1024   生成私钥
 OpenSSL&gt; pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM -nocrypt     将私钥转换成PKCS8格式
 OpenSSL&gt; rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem    生成公钥
 OpenSSL&gt; exit   ## 退出OpenSSL程序
</code></pre></li>
</ol>
<p><strong>注意：</strong>对于使用Java的开发者，将pkcs8在console中输出的私钥去除头尾、换行和空格，作为开发者私钥</p>
<h4 id="c0201_keyex">私钥及公钥文件示例</h4>
<p>经过以上步骤，开发者可以在当前文件夹中（Windows用户在C:\OpenSSL-Win32\bin）看到rsa_private_key.pem和rsa_public_key.pem两个文件，前者为私钥，后者为公钥。开发者将私钥保留，将公钥提交给支付宝网关，用于信息加密及解密。以下为使用OpenSSL生成的私钥文件和公钥文件示例。</p>
<ol>
<li><p>PKCS8处理后的私钥文件示例</p>
<pre><code> -----BEGIN PRIVATE KEY-----
 MIICeAIBADANBgkqhkiG9w0BAQEFAASCAmIwggJeAgEAAoGBAN0yqPkLXlnhM+2H
 /57aHsYHaHXazr9pFQun907TMvmbR04wHChVsKVgGUF1hC0FN9hfeYT5v2SXg1WJ
 Sg2tSgk7F29SpsF0I36oSLCIszxdu7ClO7c22mxEVuCjmYpJdqb6XweAZzv4Is66
 1jXP4PdrCTHRdVTU5zR9xUByiLSVAgMBAAECgYEAhznORRonHylm9oKaygEsqQGk
 YdBXbnsOS6busLi6xA+iovEUdbAVIrTCG9t854z2HAgaISoRUKyztJoOtJfI1wJa
 QU+XL+U3JIh4jmNx/k5UzJijfvfpT7Cv3ueMtqyAGBJrkLvXjiS7O5ylaCGuB0Qz
 711bWGkRrVoosPM3N6ECQQD8hVQUgnHEVHZYtvFqfcoq2g/onPbSqyjdrRu35a7P
 vgDAZx69Mr/XggGNTgT3jJn7+2XmiGkHM1fd1Ob/3uAdAkEA4D7aE3ZgXG/PQqlm
 3VbE/+4MvNl8xhjqOkByBOY2ZFfWKhlRziLEPSSAh16xEJ79WgY9iti+guLRAMra
 vGrs2QJBAOmKWYeaWKNNxiIoF7/4VDgrcpkcSf3uRB44UjFSn8kLnWBUPo6WV+x1
 FQBdjqRviZ4NFGIP+KqrJnFHzNgJhVUCQFzCAukMDV4PLfeQJSmna8PFz2UKva8f
 vTutTryyEYu+PauaX5laDjyQbc4RIEMU0Q29CRX3BA8WDYg7YPGRdTkCQQCG+pjU
 2FB17ZLuKRlKEdtXNV6zQFTmFc1TKhlsDTtCkWs/xwkoCfZKstuV3Uc5J4BNJDkQ
 OGm38pDRPcUDUh2/
 -----END PRIVATE KEY-----
</code></pre></li>
<li><p>公钥文件示例</p>
<pre><code> -----BEGIN PUBLIC KEY-----
 MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDQWiDVZ7XYxa4CQsZoB3n7bfxL
 DkeGKjyQPt2FUtm4TWX9OYrd523iw6UUqnQ+Evfw88JgRnhyXadp+vnPKP7unorm
 YQAfsM/CxzrfMoVdtwSiGtIJB4pfyRXjA+KL8nIa2hdQy5nLfgPVGZN4WidfUY/Q
 pkddCVXnZ4bAUaQjXQIDAQAB
 -----END PUBLIC KEY-----
</code></pre></li>
</ol>
<h2 id="c0202">接入与验证</h2>
<h3 id="c0202_intro">概述</h3>
<p>开发者生成私钥、公钥之后，将公钥提交给服务窗平台，同时下载支付宝的公钥，使用OpenSSL的方式验证签名之后便可完成接入。</p>
<p>开发者使用接口之前需要激活开发者模式，请打开<a href="https://fuwu.alipay.com/platform/developerMode.htm">服务窗平台开发者模式</a>，点击下方的“激活开发者模式”按钮。</p>
<p>建议开发者使用支付宝提供的SDK进行服务窗开发，使用SDK进行开发有以下优点：</p>
<ol>
<li>SDK会随着新接口的发布而同步更新</li>
<li>SDK会随着老接口的更新而同步更新</li>
<li>SDK让底层逻辑变得透明和简单，开发者只需关注于自身的业务逻辑</li>
<li>SDK集成了编码、签名等常用方法，开发者无需额外耗费时间</li>
<li>提供了基于SDK开发的Demo，开发者上手更容易</li>
</ol>
<p>SDK下载：</p>
<ol>
<li><a href="http://openhome.alipay.com/doc/sdkDownload.resource?sdkType=JAVA">Java-JDK 1.5 SDK</a></li>
<li><a href="http://openhome.alipay.com/doc/sdkDownload.resource?sdkType=JDK14">Java-JDK 1.4 SDK</a></li>
<li><a href="http://openhome.alipay.com/doc/sdkDownload.resource?sdkType=PHP">PHP SDK</a></li>
<li><a href="http://openhome.alipay.com/doc/sdkDownload.resource?sdkType=NET">.NET2010 SDK</a></li>
</ol>
<p>Demo下载：</p>
<ol>
<li><a href="https://i.alipayobjects.com/i/ecmng/zip/201408/Alipay Fuwuchuang Java JDK 1.5 Demo.zip">Java-JDK 1.5 Demo</a></li>
<li><a href="https://i.alipayobjects.com/i/ecmng/zip/201408/Alipay Fuwuchuang Java JDK 1.4 Demo.zip">Java-JDK 1.4 Demo</a></li>
<li><a href="https://i.alipayobjects.com/i/ecmng/zip/201408/Alipay Fuwuchuang PHP Demo.zip">PHP Demo</a></li>
<li><a href="https://i.alipayobjects.com/i/ecmng/zip/201408/Alipay Fuwuchuang DotNet Demo.zip">.NET2010 Demo</a></li>
</ol>
<h3 id="c0202_form">填写开发者网关及开发者公钥</h3>
<p>开发者将网关地址填入开发者网关一栏。</p>
<p>开发者将公钥文件去除头尾、换行和空格后的字符串填入开发者公钥一栏。</p>
<pre><code>转换前pem文件格式：
-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDQWiDVZ7XYxa4CQsZoB3n7bfxL
DkeGKjyQPt2FUtm4TWX9OYrd523iw6UUqnQ+Evfw88JgRnhyXadp+vnPKP7unorm
YQAfsM/CxzrfMoVdtwSiGtIJB4pfyRXjA+KL8nIa2hdQy5nLfgPVGZN4WidfUY/Q
pkddCVXnZ4bAUaQjXQIDAQAB
-----END PUBLIC KEY-----
转换后的字符串:
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDQWiDVZ7XYxa4CQsZoB3n7bfxLDkeGKjyQPt2FUtm4TWX9OYrd523iw6UUqnQ+Evfw88JgRnhyXadp+vnPKP7unormYQAfsM/CxzrfMoVdtwSiGtIJB4pfyRXjA+KL8nIa2hdQy5nLfgPVGZN4WidfUY/QpkddCVXnZ4bAUaQjXQIDAQAB
</code></pre><p>如下图所示：</p>
<p><img src="https://i.alipayobjects.com/i/ecmng/png/201407/38OSZgAV1J.png" alt="填写开发者网关、开发者公钥"></p>
<h3 id="c0202_public">下载支付宝公钥</h3>
<p>点击“复制公钥”按钮，可以获取支付宝公钥，支付宝公钥是经过格式化之后的字符串，如果开发者需要使用pem文件进行验签，请<a href="https://i.alipayobjects.com/i/ecmng/zip/201407/alipay_openapi_public_key.pem.zip">点此下载</a>pem公钥文件。</p>
<pre><code>支付宝公钥：
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDDI6d306Q8fIfCOaTXyiUeJHkrIvYISRcc73s3vF1ZT7XN8RNPwJxo8pWaJMmvyTn9N4HQ632qJBVHf8sxHi/fEsraprwCtzvzQETrNRwVxLO5jVmRGi60j8Ue1efIlzPXV9je9mkjzOmdssymZkh2QhUrCmZYI/FCEa3/cNMW0QIDAQAB
PEM格式化后的支付宝公钥：
-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDDI6d306Q8fIfCOaTXyiUeJHkr
IvYISRcc73s3vF1ZT7XN8RNPwJxo8pWaJMmvyTn9N4HQ632qJBVHf8sxHi/fEsra
prwCtzvzQETrNRwVxLO5jVmRGi60j8Ue1efIlzPXV9je9mkjzOmdssymZkh2QhUr
CmZYI/FCEa3/cNMW0QIDAQAB
-----END PUBLIC KEY-----
</code></pre><h3 id="c0202_sign">使用支付宝公钥进行验签</h3>
<p>当开发者完成网关代码的部署之后，便可以点击“提交”按钮，激活开发者模式，接入服务窗平台。</p>
<p>此时，支付宝网关会向开发者网关发送一条验证消息，以POST方式请求，以下为一个请求示例：</p>
<pre><code>REQUEST URL: http://example.com/gateway.do
REQUEST METHOD: POST
CONTENT:
    service=alipay.service.check
    sign=ntjOmXFGJMdfdMnrTL5rEp9QG8d0lDEoGg3ZHvqemHeI8BlQoEsFbhEn0IfQT+pvfJz5RCuE+3Qh1X7I4z5iTIiGjDBstc0xeuiAmtP9TrJZuw2jUAODFB9qOwBJLNcWlKHUGTU/db/qRsJQCj8EjoJvSi9MRM/xKv/XmduS/C4=
    sign_type=RSA
    charset=GBK
    biz_content=&lt;?xml version=&quot;1.0&quot; encoding=&quot;gbk&quot;?&gt;&lt;XML&gt;&lt;AppId&gt;&lt;![CDATA[2014072300007148]]&gt;&lt;/AppId&gt;&lt;FromUserId&gt;&lt;/FromUserId&gt;&lt;CreateTime&gt;&lt;![CDATA[1406083506817]]&gt;&lt;/CreateTime&gt;&lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt;&lt;EventType&gt;&lt;![CDATA[verifygw]]&gt;&lt;/EventType&gt;&lt;ActionParam&gt;&lt;/ActionParam&gt;&lt;AgreementId&gt;&lt;/AgreementId&gt;&lt;AccountNo&gt;&lt;/AccountNo&gt;&lt;/XML&gt;
</code></pre><p>开发者接收到该消息之后，需要使用支付宝的公钥对签名作验证，以确保该消息来源可靠。</p>
<ol>
<li><p>将支付宝返回的POST参数(不包含sign参数)做字母排序，组成query类型的字符串，比如上文的POST请求组成的query类型字符串为：</p>
<pre><code> biz_content=&lt;?xml version=&quot;1.0&quot; encoding=&quot;gbk&quot;?&gt;&lt;XML&gt;&lt;AppId&gt;&lt;![CDATA[2014072300007148]]&gt;&lt;/AppId&gt;&lt;FromUserId&gt;&lt;/FromUserId&gt;&lt;CreateTime&gt;&lt;![CDATA[1406083506817]]&gt;&lt;/CreateTime&gt;&lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt;&lt;EventType&gt;&lt;![CDATA[verifygw]]&gt;&lt;/EventType&gt;&lt;ActionParam&gt;&lt;/ActionParam&gt;&lt;AgreementId&gt;&lt;/AgreementId&gt;&lt;AccountNo&gt;&lt;/AccountNo&gt;&lt;/XML&gt;&amp;charset=GBK&amp;service=alipay.service.check&amp;sign_type=RSA
</code></pre></li>
<li><p>将签名参数使用base64解码为字节码串</p>
</li>
<li><p>使用OpenSSL的验签方法及支付宝公钥验证签名，以下为php代码的一个片段，其中<strong>$data</strong>为经过1排序处理后的query字符串，<strong>$rsaPublicKeyFilePath</strong>指支付宝公钥PEM文件的文件地址</p>
<pre><code> /* 使用支付宝的公钥对支付宝来的消息进行验签 */
 public function verify($data, $sign, $rsaPublicKeyFilePath) {

     /* 读取公钥文件，PEM格式 */    
     $pubKey = file_get_contents($rsaPublicKeyFilePath);

     /* 转换为openssl格式密钥 */
     $res = openssl_get_publickey($pubKey);

     /* 调用openssl内置方法验签 */
     $result = (bool) openssl_verify($data, base64_decode($sign), $res);

     /* 释放资源 */
     openssl_free_key($res);

     /* 返回验签结果 */
     return $result;
 }
</code></pre></li>
</ol>
<h3 id="c0202_response">返回验签成功消息</h3>
<p>开发者验签成功之后，需要向支付宝网关回复一条消息，表示验签成功。支付宝收到符合规则的消息之后，开发者模式就激活了。以下为回复消息的格式（其中biz_content为开发者公钥）：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;GBK&quot;?&gt;
&lt;alipay&gt;
    &lt;response&gt;
        &lt;biz_content&gt;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDQWiDVZ7XYxa4CQsZoB3n7bfxLDkeGKjyQPt2FUtm4TWX9OYrd523iw6UUqnQ+Evfw88JgRnhyXadp+vnPKP7unormYQAfsM/CxzrfMoVdtwSiGtIJB4pfyRXjA+KL8nIa2hdQy5nLfgPVGZN4WidfUY/QpkddCVXnZ4bAUaQjXQIDAQAB&lt;/biz_content&gt;
        &lt;success&gt;true&lt;/success&gt;
    &lt;/response&gt;
    &lt;sign&gt;DXr8LVfHytoZ3RR0K95pzGtA3d9LdpjIjLEis2BDIPQisPwS+FMFxZt9NCMt531EeDj/nbzoIAz8Or7PuqxNfSzNI8qnhirm/Hvr8uedXX9JiQxHu8q3Rw2lJWD8cqQzgf3xwV/+wbN8yuI7s8xjo6odq6NCqrAIu7E0DDfZyKo=&lt;/sign&gt;
    &lt;sign_type&gt;RSA&lt;/sign_type&gt;
&lt;/alipay&gt;
</code></pre><p>开发者可以参考相关Demo（Demo包请<a href="#c1101_download">点此下载</a>）。</p>
<h2 id="c0203">消息交互体系</h2>
<h3 id="c0203_intro">概述</h3>
<p>支付宝网关与开发者的通信消息主要分为两类：</p>
<ol>
<li>开发者网关接收支付宝网关发送的消息(下文简称接收消息)</li>
<li>开发者网关主动调用支付宝网关接口(下文简称OpenAPI)</li>
</ol>
<p>在支付宝网关与开发者网关消息交互中传输的用户ID都是经过加密处理的OpenId，以保障用户隐私安全。</p>
<h3 id="c0203_push">接收消息</h3>
<p>当用户与服务窗发生交互时，支付宝网关会向开发者网关发送POST请求。比如，用户关注服务窗时，支付宝网关会向开发者网关发送一条关注事件消息。下文为一个示例：</p>
<pre><code>REQUEST URL: http://example.com/gateway.do
REQUEST METHOD: POST
CONTENT:
    sign=SSK/h9WV8H+ObDwOGEItQOGPocc4IgpRPHgwUZiSU2DSGNC2o+EsYm8ajJZ6EkEWcvKcVyPiUNU1p7vzjrhv/T+KJ1Z5+BFTJ3ibrCZaZppoMk47se5LjjTDUwaKDDAb2zmK85ZOTt+8LkB3MEiPG/kiYomud7r7kvnoRCEixbY=
    biz_content=&lt;XML&gt;&lt;AppId&gt;&lt;![CDATA[2014072300007148]]&gt;&lt;/AppId&gt;&lt;FromUserId&gt;&lt;![CDATA[CogmJcgdBQvCr1jdSWXmMul3JwoaXmLBrbkSty7ivP0SaOemwnUkRdOm5AITm38701]]&gt;&lt;/FromUserId&gt;&lt;CreateTime&gt;1406165628612&lt;/CreateTime&gt;&lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt;&lt;EventType&gt;&lt;![CDATA[follow]]&gt;&lt;/EventType&gt;&lt;ActionParam&gt;&lt;![CDATA[]]&gt;&lt;/ActionParam&gt;&lt;AgreementId&gt;&lt;![CDATA[]]&gt;&lt;/AgreementId&gt;&lt;AccountNo&gt;&lt;![CDATA[]]&gt;&lt;/AccountNo&gt;&lt;UserInfo&gt;&lt;![CDATA[{&quot;logon_id&quot;:&quot;135**1009&quot;,&quot;user_name&quot;:&quot;*iuxu527&quot;}]]&gt;&lt;/UserInfo&gt;&lt;/XML&gt;
    sign_type=RSA
    service=alipay.mobile.public.message.notify
    charset=GBK

注：所有请求参数需经过编码处理，本示例给出的是未经编码处理时的请求参数
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>sign</td>
<td>RSA加密算法签名</td>
</tr>
<tr>
<td>biz_content</td>
<td>业务消息体内容，xml格式，不含换行、空格</td>
</tr>
<tr>
<td>sign_type</td>
<td>签名方式，目前只支持RSA</td>
</tr>
<tr>
<td>service</td>
<td>发起消息的支付宝接口名称</td>
</tr>
<tr>
<td>charset</td>
<td>消息编码，默认为GBK，开发者网关需要以该编码进行解码</td>
</tr>
</tbody>
</table>
<p>POST消息体的格式固定，后续将只介绍各类消息的service参数及biz_content参数，对整个消息体不再赘述。</p>
<p>当开发者网关接收到支付宝网关发送的推送消息时，需要向支付宝网关回复一条接收成功消息，告知支付宝网关消息接收成功（注意：请务必对支付宝推送的每条消息都作回复，否则支付宝网关会尝试做重试请求处理）。回复消息格式如下：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;GBK&quot;?&gt;
&lt;alipay&gt;
    &lt;response&gt;
        &lt;XML&gt;
            &lt;ToUserId&gt;&lt;![CDATA[aYMvrMC8+qdi3Mj1lqxRZJPUsrychFTewHXFVXq5ySDxWgIluiZN3K2r70Eebm4r01]]&gt;&lt;/ToUserId&gt;
            &lt;AppId&gt;&lt;![CDATA[2014042900005397]]&gt;&lt;/AppId&gt;
            &lt;CreateTime&gt;1401448605&lt;/CreateTime&gt;
            &lt;MsgType&gt;&lt;![CDATA[ack]]&gt;&lt;/MsgType&gt;
        &lt;/XML&gt;
    &lt;/response&gt;
    &lt;sign&gt;djRg8yFRYRJfieP69uFIbJRXivOEwCBZFmfkwiPcoDGgLClm2+loZhRt61OsRICSKHrWFWmb3T5BYguwg0zWuahihEs7Zig270gkCTYVHMj5H0heo0WwQAUxtkBcguyGQSy23bh7Swzrho3l6xysKD3ZxHF1TrULrPTS19KHGvg=&lt;/sign&gt;
    &lt;sign_type&gt;RSA&lt;/sign_type&gt;
&lt;/alipay&gt;
</code></pre><p>sign_type固定为RSA，sign是对该消息体的签名，除此之外，response中的各项参数分别表示：</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>ToUserId</td>
<td>发送消息用户的OpenId</td>
</tr>
<tr>
<td>AppId</td>
<td>服务窗账号ID</td>
</tr>
<tr>
<td>CreateTime</td>
<td>消息发送时间</td>
</tr>
<tr>
<td>MsgType</td>
<td>固定为ack</td>
</tr>
</tbody>
</table>
<h3 id="c0203_openapi">OpenAPI</h3>
<p>服务窗平台开放了众多的OpenAPI供开发者主动调用，开发者可以在<a href="https://fuwu.alipay.com/platform/developerMode.htm">服务窗平台-&gt;开发者模式</a>中申请接口权限。</p>
<p>开发者网关可以向支付宝网关发送POST消息，主动调用支付宝OpenAPI，以下为开发者调用创建菜单API时发送的POST消息：</p>
<pre><code>REQUEST URL: https://openapi.alipay.com/gateway.do
REQUEST METHOD: POST
CONTENT:
    app_id=2014072300007148
    method=alipay.mobile.public.menu.add
    charset=GBK
    sign_type=RSA
    timestamp=2014-07-24 03:07:50
    biz_content={&quot;button&quot;:[{&quot;actionParam&quot;:&quot;ZFB_HFCZ&quot;,&quot;actionType&quot;:&quot;out&quot;,&quot;name&quot;:&quot;话费充值&quot;},{&quot;name&quot;:&quot;查询&quot;,&quot;subButton&quot;:[{&quot;actionParam&quot;:&quot;ZFB_YECX&quot;,&quot;actionType&quot;:&quot;out&quot;,&quot;name&quot;:&quot;余额查询&quot;},{&quot;actionParam&quot;:&quot;ZFB_LLCX&quot;,&quot;actionType&quot;:&quot;out&quot;,&quot;name&quot;:&quot;流量查询&quot;},{&quot;actionParam&quot;:&quot;ZFB_HFCX&quot;,&quot;actionType&quot;:&quot;out&quot;,&quot;name&quot;:&quot;话费查询&quot;}]},{&quot;actionParam&quot;:&quot;http://m.alipay.com&quot;,&quot;actionType&quot;:&quot;link&quot;,&quot;name&quot;:&quot;最新优惠&quot;}]}
    sign=e9zEAe4TTQ4LPLQvETPoLGXTiURcxiAKfMVQ6Hrrsx2hmyIEGvSfAQzbLxHrhyZ48wOJXTsD4FPnt+YGdK57+fP1BCbf9rIVycfjhYCqlFhbTu9pFnZgT55W+xbAFb9y7vL0MyAxwXUXvZtQVqEwW7pURtKilbcBTEW7TAxzgro=
    version=1.0

注：所有请求参数需经过编码处理，本示例给出的是未经编码时的请求参数
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>app_id</td>
<td>开发者服务窗的AppId</td>
</tr>
<tr>
<td>method</td>
<td>支付宝OpenAPI接口名称</td>
</tr>
<tr>
<td>charset</td>
<td>消息编码，默认为GBK，开发者网关需要以该编码进行解码</td>
</tr>
<tr>
<td>sign_type</td>
<td>签名方式，目前只支持RSA</td>
</tr>
<tr>
<td>timestamp</td>
<td>发送消息的时间，格式如2014-07-24 03:07:50</td>
</tr>
<tr>
<td>biz_content</td>
<td>消息体内容，JSON格式，不含换行、空格</td>
</tr>
<tr>
<td>sign</td>
<td>RSA加密算法签名</td>
</tr>
<tr>
<td>version</td>
<td>接口版本号，默认为1.0</td>
</tr>
</tbody>
</table>
<p>POST消息体的格式固定，后续将只介绍各类OpenAPI调用的method参数及biz_content参数，对整个消息体不再赘述。</p>
<p>支付宝网关接收到开发者网关消息后，无论成功还是失败，都会回复一条JSON消息。JSON消息有两个属性，第一个属性标明是哪个接口的回复消息。比如调用&quot;alipay.mobile.public.menu.add&quot;，回复的JSON消息的第一个属性名为&quot;alipay_mobile_public_menu_add_response&quot;。</p>
<p>以下为创建菜单成功的一条回复消息： </p>
<pre><code>{
    &quot;alipay_mobile_public_menu_add_response&quot;: {
        &quot;code&quot;: 200,
        &quot;msg&quot;: &quot;成功&quot;
    },
    &quot;sign&quot;: &quot;oi7sKzfEu6Jh/UwlPXc4+/AIugIGPiXZJfVWvvSbLU/Jj2ET5TPQEj2/41z8VQ/0pQppJp4yEITadsOKX5rf92kqO6vVnD1y+k9Eq5qQU2iy2YM1lXfBJRekPlsUy2aaDElbrHXYY8CQwQgOeQgv3WL+MukrFs2+syqnnX7ugjI=&quot;
}
</code></pre><p>以下为创建菜单失败的一条回复消息：</p>
<pre><code>{
    &quot;alipay_mobile_public_menu_add_response&quot;: {
        &quot;code&quot;: 11013,
        &quot;msg&quot;: &quot;菜单已经创建过&quot;
    },
    &quot;sign&quot;: &quot;d9ob0/1Fz0mmrG7fSSp61O3OZurTXOv9uljPU84GlgEZ0oZicIbRQNPJElUo6eLU5rJyh8CdYz14Fvn3ouzzh9FZ/ao6TvUpilmBTOi8hRO026ziV2L6HhUkvyIjnXjBFQqsX0yKlrQuv4fLwNt1lwUQwcOzEEr2Smo7/l9mCn8=&quot;
}
</code></pre><h1 id="c03">接收消息</h1>
<h2 id="c0301">开发者接入验证消息</h2>
<h3 id="c0301_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.service.check</p>
<p>使用场景举例：开发者开通开发者模式时支付宝网关向开发者网关发送验证消息。</p>
</blockquote>
<p>开发者如何回复该消息详见<a href="#c0202_response">接入与验证</a></p>
<h3 id="c0301_content">业务消息内容</h3>
<p>支付宝网关发送的POST消息中biz_content的内容示例如下：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;gbk&quot;?&gt;
&lt;XML&gt;
    &lt;AppId&gt;&lt;![CDATA[2014072300007148]]&gt;&lt;/AppId&gt;
    &lt;FromUserId&gt;&lt;/FromUserId&gt;
    &lt;CreateTime&gt;&lt;![CDATA[1406083506817]]&gt;&lt;/CreateTime&gt;
    &lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt;
    &lt;EventType&gt;&lt;![CDATA[verifygw]]&gt;&lt;/EventType&gt;
    &lt;ActionParam&gt;&lt;/ActionParam&gt;
    &lt;AgreementId&gt;&lt;/AgreementId&gt;
    &lt;AccountNo&gt;&lt;/AccountNo&gt;
&lt;/XML&gt;
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppId</td>
<td>服务窗账号ID</td>
</tr>
<tr>
<td>FromUserId</td>
<td>空值</td>
</tr>
<tr>
<td>CreateTime</td>
<td>消息创建时间</td>
</tr>
<tr>
<td>MsgType</td>
<td>消息类型，事件类消息固定为event</td>
</tr>
<tr>
<td>EventType</td>
<td>事件类型，固定为verifygw</td>
</tr>
<tr>
<td>ActionParam</td>
<td>空值</td>
</tr>
<tr>
<td>AgreementId</td>
<td>空值</td>
</tr>
<tr>
<td>AccountNo</td>
<td>空值</td>
</tr>
</tbody>
</table>
<div id="alipay.mobile.public.message.notify"></div><h2 id="c0302">事件消息</h2>
<h3 id="c0302_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.mobile.public.message.notify</p>
<p>使用场景举例：接收用户操作事件通知，例如关注服务窗、菜单点击等，开发者可以使用<a href="#c0401">异步发送消息</a>功能向用户回复消息，实现诸如查询余额，推送最新优惠消息等业务逻辑</p>
</blockquote>
<p>用户在与服务窗账号交互过程中会产生以下4种事件：</p>
<ol>
<li>关注事件     - 用户关注服务窗</li>
<li>取消关注事件 - 用户取消关注服务窗</li>
<li>进入事件     - 用户进入服务窗页面，包括用户点击和扫码二维码等方式进入服务窗</li>
<li>菜单点击事件     - 用户点击某个菜单项</li>
</ol>
<p>当开发者网关接收消息成功之后，请回复一条接收成功消息，详见<a href="#c0203">消息交互体系</a></p>
<h3 id="c0302_content">业务消息内容</h3>
<h4 id="c0302_follow_unfollow">关注与取消关注事件</h4>
<p>支付宝网关向开发者网关发送的POST消息中biz_content的内容示例如下：</p>
<pre><code>&lt;XML&gt;
    &lt;AppId&gt;&lt;![CDATA[2014070100171523]]&gt;&lt;/AppId&gt;
    &lt;FromUserId&gt;&lt;![CDATA[R8qtKrh1dS49uWaLZUbPr0re8hjWnYClscK-vjUi4qOHCIhO5aJXi4frP7yHEJoJ01]]&gt;&lt;/FromUserId&gt;
    &lt;CreateTime&gt;1405943673657&lt;/CreateTime&gt;
    &lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt;
    &lt;EventType&gt;&lt;![CDATA[follow]]&gt;&lt;/EventType&gt;
    &lt;ActionParam&gt;&lt;![CDATA[]]&gt;&lt;/ActionParam&gt;
    &lt;AgreementId&gt;&lt;![CDATA[]]&gt;&lt;/AgreementId&gt;
    &lt;AccountNo&gt;&lt;![CDATA[]]&gt;&lt;/AccountNo&gt;
    &lt;UserInfo&gt;&lt;![CDATA[{&quot;logon_id&quot;:&quot;135****1009&quot;,&quot;user_name&quot;:&quot;*iuxu527&quot;}]]&gt;&lt;/UserInfo&gt;
&lt;/XML&gt;
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppId</td>
<td>服务窗账号ID</td>
</tr>
<tr>
<td>FromUserId</td>
<td>用户OpenId</td>
</tr>
<tr>
<td>CreateTime</td>
<td>消息创建时间</td>
</tr>
<tr>
<td>MsgType</td>
<td>消息类型，事件类消息固定为event</td>
</tr>
<tr>
<td>EventType</td>
<td>事件类型。follow：关注事件；unfollow：取消关注事件</td>
</tr>
<tr>
<td>ActionParam</td>
<td>空值</td>
</tr>
<tr>
<td>AgreementId</td>
<td>空值</td>
</tr>
<tr>
<td>AccountNo</td>
<td>空值</td>
</tr>
<tr>
<td>UserInfo</td>
<td>支付宝的用户信息，JSON格式，包含加星的用户账号及加星的用户名</td>
</tr>
</tbody>
</table>
<p>UserInfo的一个示例：</p>
<pre><code>{
  &quot;logon_id&quot;: &quot;135**1009&quot;,
  &quot;user_name&quot;: &quot;*iuxu527&quot;
}
</code></pre><p>开发者可以参考相关Demo（Demo包请<a href="#c1101_download">点此下载</a>）。</p>
<h4 id="c0302_enter">进入事件</h4>
<p>支付宝网关向开发者网关发送的POST消息中biz_content的内容示例如下：</p>
<pre><code>&lt;XML&gt;
    &lt;AppId&gt;&lt;![CDATA[2014070100171523]]&gt;&lt;/AppId&gt;
    &lt;FromUserId&gt;&lt;![CDATA[R8qtKrh1dS49uWaLZUbPr0re8hjWnYClscK-vjUi4qOHCIhO5aJXi4frP7yHEJoJ01]]&gt;&lt;/FromUserId&gt;
    &lt;CreateTime&gt;1405943673657&lt;/CreateTime&gt;
    &lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt;
    &lt;EventType&gt;&lt;![CDATA[enter]]&gt;&lt;/EventType&gt;
    &lt;ActionParam&gt;&lt;![CDATA[{&quot;scene&quot;:{&quot;sceneId&quot;: &quot;1234&quot;}}]]&gt;&lt;/ActionParam&gt;
    &lt;AgreementId&gt;&lt;![CDATA[]]&gt;&lt;/AgreementId&gt;
    &lt;AccountNo&gt;&lt;![CDATA[]]&gt;&lt;/AccountNo&gt;
    &lt;UserInfo&gt;&lt;![CDATA[{&quot;logon_id&quot;:&quot;135****1009&quot;,&quot;user_name&quot;:&quot;*iuxu527&quot;}]]&gt;&lt;/UserInfo&gt;
&lt;/XML&gt;
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppId</td>
<td>服务窗账号ID</td>
</tr>
<tr>
<td>FromUserId</td>
<td>用户OpenId</td>
</tr>
<tr>
<td>CreateTime</td>
<td>消息创建时间</td>
</tr>
<tr>
<td>MsgType</td>
<td>消息类型，事件类消息固定为event</td>
</tr>
<tr>
<td>EventType</td>
<td>事件类型，固定为enter</td>
</tr>
<tr>
<td>ActionParam</td>
<td>用户从特定场景（比如扫描开发者自定义的二维码）进入服务窗时，值为开发者自定义参数，详见<a href="#c0701">带参推广二维码</a></td>
</tr>
<tr>
<td>AgreementId</td>
<td>空值</td>
</tr>
<tr>
<td>AccountNo</td>
<td>空值</td>
</tr>
<tr>
<td>UserInfo</td>
<td>支付宝的用户信息，JSON格式，包含加星的用户账号及加星的用户名</td>
</tr>
</tbody>
</table>
<p>以下为二维码扫码进入场景enter事件中ActionParam示例，二维码生成方法详见<a href="#c0701">带参推广二维码</a>，开发者可以通过匹配sceneId的方法，使用<a href="#c0401">异步单发消息</a>接口发送服务内容：</p>
<pre><code>{
    &quot;scene&quot;: {
        &quot;sceneId&quot;: &quot;1234&quot;
    }
}
</code></pre><p>开发者可以参考相关Demo（Demo包请<a href="#c1101_download">点此下载</a>）。</p>
<h4 id="c0302_click">菜单点击事件</h4>
<p>支付宝网关向开发者网关发送的POST消息中biz_content的内容示例如下：</p>
<pre><code>&lt;XML&gt;
    &lt;AppId&gt;&lt;![CDATA[2014070100171523]]&gt;&lt;/AppId&gt;
    &lt;FromUserId&gt;&lt;![CDATA[R8qtKrh1dS49uWaLZUbPr0re8hjWnYClscK-vjUi4qOHCIhO5aJXi4frP7yHEJoJ01]]&gt;&lt;/FromUserId&gt;
    &lt;CreateTime&gt;1405943673657&lt;/CreateTime&gt;
    &lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt;
    &lt;EventType&gt;&lt;![CDATA[click]]&gt;&lt;/EventType&gt;
    &lt;ActionParam&gt;&lt;![CDATA[test_menu_key]]&gt;&lt;/ActionParam&gt;
    &lt;AgreementId&gt;&lt;![CDATA[]]&gt;&lt;/AgreementId&gt;
    &lt;AccountNo&gt;&lt;![CDATA[]]&gt;&lt;/AccountNo&gt;
    &lt;UserInfo&gt;&lt;![CDATA[{&quot;logon_id&quot;:&quot;135****1009&quot;,&quot;user_name&quot;:&quot;*iuxu527&quot;}]]&gt;&lt;/UserInfo&gt;
&lt;/XML&gt;
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppId</td>
<td>服务窗账号ID</td>
</tr>
<tr>
<td>FromUserId</td>
<td>用户OpenId</td>
</tr>
<tr>
<td>CreateTime</td>
<td>消息创建时间</td>
</tr>
<tr>
<td>MsgType</td>
<td>消息类型，事件类消息固定为event</td>
</tr>
<tr>
<td>EventType</td>
<td>事件类型，固定为click</td>
</tr>
<tr>
<td>ActionParam</td>
<td>行为参数，菜单中设置的actionParam值，详见<a href="#c0602">创建菜单</a></td>
</tr>
<tr>
<td>AgreementId</td>
<td>空值</td>
</tr>
<tr>
<td>AccountNo</td>
<td>空值</td>
</tr>
<tr>
<td>UserInfo</td>
<td>支付宝的用户信息，JSON格式，包含加星的用户账号及加星的用户名</td>
</tr>
</tbody>
</table>
<p>开发者可以参考相关Demo（Demo包请<a href="#c1101_download">点此下载</a>）。</p>
<h2 id="c0303">文本消息</h2>
<h3 id="c0303_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.mobile.public.message.notify</p>
<p>使用场景举例：接收用户主动发送的文字消息，开发者可以使用<a href="#c0401">异步单发消息</a>功能向用户回复消息，实现诸如查询余额、推送最新优惠消息、客服等业务逻辑</p>
</blockquote>
<p>当开发者网关接收消息成功之后，请回复一条接收成功消息，详见<a href="#c0203">消息交互体系</a></p>
<h3 id="c0303_content">业务消息内容</h3>
<p>支付宝网关发送的POST消息中biz_content的内容示例如下：</p>
<pre><code>&lt;XML&gt;
    &lt;Text&gt;
        &lt;Content&gt;&lt;![CDATA[Hello]]&gt;&lt;/Content&gt;
    &lt;/Text&gt;
    &lt;AppId&gt;&lt;![CDATA[2014070100171523]]&gt;&lt;/AppId&gt;
    &lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt;
    &lt;CreateTime&gt;&lt;![CDATA[1406104130464]]&gt;&lt;/CreateTime&gt;
    &lt;FromUserId&gt;&lt;![CDATA[R8qtKrh1dS49uWaLZUbPr0re8hjWnYClscK-vjUi4qOHCIhO5aJXi4frP7yHEJoJ01]]&gt;&lt;/FromUserId&gt;
    &lt;MsgId&gt;&lt;![CDATA[140723160000000004]]&gt;&lt;/MsgId&gt;
    &lt;UserInfo&gt;&lt;![CDATA[{&quot;logon_id&quot;:&quot;135****1009&quot;,&quot;user_name&quot;:&quot;*iuxu527&quot;}]]&gt;&lt;/UserInfo&gt;
&lt;/XML&gt;
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Text</td>
<td>文本消息内容</td>
</tr>
<tr>
<td>AppId</td>
<td>服务窗账号ID</td>
</tr>
<tr>
<td>MsgType</td>
<td>消息类型，固定为text</td>
</tr>
<tr>
<td>CreateTime</td>
<td>消息创建时间</td>
</tr>
<tr>
<td>FromUserId</td>
<td>用户OpenId</td>
</tr>
<tr>
<td>MsgId</td>
<td>消息ID</td>
</tr>
<tr>
<td>UserInfo</td>
<td>支付宝的用户信息，JSON格式，包含加星的用户账号及加星的用户名</td>
</tr>
</tbody>
</table>
<p>UserInfo的一个示例：</p>
<pre><code>{
  &quot;logon_id&quot;: &quot;135**1009&quot;,
  &quot;user_name&quot;: &quot;*iuxu527&quot;
}
</code></pre><p>开发者可以参考相关Demo（Demo包请<a href="#c1101_download">点此下载</a>）。</p>
<h2 id="c0304">图片消息</h2>
<h3 id="c0304_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.mobile.public.message.notify</p>
<p>使用场景举例：接收用户主动发送的图片消息，开发者可以使用<a href="#c0401">异步单发消息</a>功能向用户回复消息，实现诸如查询余额、推送最新优惠消息、客服等业务逻辑</p>
</blockquote>
<p>当开发者网关接收消息成功之后，请回复一条接收成功消息，详见<a href="#c0203">消息交互体系</a></p>
<h3 id="c0304_content">业务消息内容</h3>
<p>支付宝网关发送的POST消息中biz_content的内容示例如下：</p>
<pre><code>&lt;XML&gt;
  &lt;Image&gt;
    &lt;MediaId&gt;&lt;![CDATA[L21pZnMvVDF4ZlFBWGpGWFhYYUNucHJYP3Q9YW13ZiZ4c2lnPTFiNTNkODhjZmQ5MDkxNWRjOWJlMmZlMjc1NTBjYzk1452]]&gt;&lt;/MediaId&gt;
    &lt;Format&gt;&lt;![CDATA[jpg]]&gt;&lt;/Format&gt;
  &lt;/Image&gt;
  &lt;AppId&gt;&lt;![CDATA[2014070100171523]]&gt;&lt;/AppId&gt;
  &lt;MsgType&gt;&lt;![CDATA[image]]&gt;&lt;/MsgType&gt;
  &lt;CreateTime&gt;&lt;![CDATA[1406104130464]]&gt;&lt;/CreateTime&gt;
  &lt;FromUserId&gt;&lt;![CDATA[R8qtKrh1dS49uWaLZUbPr0re8hjWnYClscK-vjUi4qOHCIhO5aJXi4frP7yHEJoJ01]]&gt;&lt;/FromUserId&gt;
  &lt;MsgId&gt;&lt;![CDATA[140723160000000004]]&gt;&lt;/MsgId&gt;
  &lt;UserInfo&gt;&lt;![CDATA[{&quot;logon_id&quot;:&quot;135****1009&quot;,&quot;user_name&quot;:&quot;*iuxu527&quot;}]]&gt;&lt;/UserInfo&gt;
&lt;/XML&gt;
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Image</td>
<td>图片消息内容</td>
</tr>
<tr>
<td>MediaId</td>
<td>图片媒体ID，如jpg</td>
</tr>
<tr>
<td>Format</td>
<td>图片文件格式</td>
</tr>
<tr>
<td>AppId</td>
<td>服务窗账号ID</td>
</tr>
<tr>
<td>MsgType</td>
<td>消息类型，固定为text</td>
</tr>
<tr>
<td>CreateTime</td>
<td>消息创建时间</td>
</tr>
<tr>
<td>FromUserId</td>
<td>用户OpenId</td>
</tr>
<tr>
<td>MsgId</td>
<td>消息ID</td>
</tr>
<tr>
<td>UserInfo</td>
<td>支付宝的用户信息，JSON格式，包含加星的用户账号及加星的用户名</td>
</tr>
</tbody>
</table>
<p>UserInfo的一个示例：</p>
<pre><code>{
  &quot;logon_id&quot;: &quot;135**1009&quot;,
  &quot;user_name&quot;: &quot;*iuxu527&quot;
}
</code></pre><h3 id="c0304_download">使用mediaId下载图片</h3>
<blockquote>
<p>接口网关地址：<a href="https://openfile.alipay.com/chat/multimedia.do">https://openfile.alipay.com/chat/multimedia.do</a></p>
<p>接口名称：alipay.mobile.public.multimedia.download</p>
<p>使用场景举例：开发者可通过本接口来下载用户聊天发送的图片。</p>
<p><strong>注：</strong>本接口与<a href="#c0203">消息交互体系</a>中的网关地址不同，消息体及调用方式相同。</p>
</blockquote>
<h4 id="-">业务消息内容</h4>
<pre><code>{
    &quot;mediaId&quot;: &quot;L21pZnMvVDFucFVGWGZKYlhYYUNucHJYP3Q9YW13ZiZ4c2lnPTEzYWYwZjE1MmU2OTVhZTRlYjRkNGVhYjhlZGU2MzIw052&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>mediaId</td>
<td>用户聊天发送的图片文件</td>
</tr>
</tbody>
</table>
<h4 id="-">同步响应结果</h4>
<p>如果调用成功，将返回一个Content-Type为图片格式HTTP请求，包含了图片的数据流</p>
<h1 id="c04">发送消息</h1>
<div id="alipay.mobile.public.message.custom.send"></div><div id="alipay.mobile.public.message.push"></div><h2 id="c0401">异步单发消息</h2>
<h3 id="c0401_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.mobile.public.message.custom.send</p>
<p>使用场景举例：开发者可以使用该接口实现对用户消息的回复功能，也可以使用该接口实现客服等扩展功能。</p>
</blockquote>
<p>注：用户主动与服务窗交互的24小时之内，服务窗可以使用该接口向该用户进行消息推送</p>
<p>该接口可以发送以下2种消息：</p>
<ol>
<li>文本消息</li>
<li>图文消息</li>
</ol>
<h3 id="c0401_content">业务消息内容</h3>
<h4 id="c0401_text">文本消息</h4>
<pre><code>{
    &quot;toUserId&quot;: &quot;m7DZN0VfcHYP6IRA1sP1gBuSX3JjLZtwilbxOzPGDUrbq9FV8CBamV+6ZPDwOg7401&quot;,
    &quot;msgType&quot;: &quot;text&quot;,
    &quot;createTime&quot;: 1406634435601,
    &quot;text&quot;: {
        &quot;content&quot;: &quot;你好&quot;
    }
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>toUserId</td>
<td>是</td>
<td>消息接收用户的OpenId</td>
</tr>
<tr>
<td>msgType</td>
<td>是</td>
<td>消息类型，text</td>
</tr>
<tr>
<td>createTime</td>
<td>是</td>
<td>消息创建时间</td>
</tr>
<tr>
<td>content</td>
<td>是</td>
<td>文本消息内容</td>
</tr>
</tbody>
</table>
<p>开发者可以参考相关Demo（Demo包请<a href="#c1101_download">点此下载</a>）。</p>
<h4 id="c0401_article">图文消息</h4>
<p>单条图文消息示例：</p>
<pre><code>{
    &quot;toUserId&quot;: &quot;R8qtKrh1dS49uWaLZUbPr0re8hjWnYClscK-vjUi4qOHCIhO5aJXi4frP7yHEJoJ01&quot;,
    &quot;msgType&quot;: &quot;image-text&quot;,
    &quot;createTime&quot;: 1406634435601,
    &quot;articles&quot;: [
        {
            &quot;actionName&quot;: &quot;立即查看&quot;,
            &quot;desc&quot;: &quot;图文内容&quot;,
            &quot;imageUrl&quot;: &quot;http: //example.com/abc.jpg&quot;,
            &quot;title&quot;: &quot;标题&quot;,
            &quot;url&quot;: &quot;https://www.example.com/a.php&quot;,
            &quot;authType&quot;: &quot;loginAuth&quot;
        }
    ]
}
</code></pre><p>多条图文消息示例：</p>
<pre><code>{
    &quot;toUserId&quot;: &quot;R8qtKrh1dS49uWaLZUbPr0re8hjWnYClscK-vjUi4qOHCIhO5aJXi4frP7yHEJoJ01&quot;,
    &quot;msgType&quot;: &quot;image-text&quot;,
    &quot;createTime&quot;: 1406634435601,
    &quot;articles&quot;: [
        {
            &quot;actionName&quot;: &quot;立即查看&quot;,
            &quot;desc&quot;: &quot;图文内容&quot;,
            &quot;imageUrl&quot;: &quot;http: //example.com/abc.jpg&quot;,
            &quot;title&quot;: &quot;标题&quot;,
            &quot;url&quot;: &quot;https://www.example.com/a.php&quot;,
            &quot;authType&quot;: &quot;loginAuth&quot;
        },
        {
            &quot;actionName&quot;: &quot;查看余额&quot;,
            &quot;desc&quot;: &quot;图文内容&quot;,
            &quot;imageUrl&quot;: &quot;http: //example.com/efg.jpg&quot;,
            &quot;title&quot;: &quot;标题2&quot;,
            &quot;url&quot;: &quot;https://www.example.com/b.php&quot;,
            &quot;authType&quot;: &quot;loginAuth&quot;
        }
    ]
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>toUserId</td>
<td>是</td>
<td>消息接收用户的OpenId</td>
</tr>
<tr>
<td>msgType</td>
<td>是</td>
<td>消息类型，image-text</td>
</tr>
<tr>
<td>createTime</td>
<td>是</td>
<td>消息创建时间</td>
</tr>
<tr>
<td>articles</td>
<td>是</td>
<td>图文消息子消息项集合，单条消息最多10个子项，否则会发送失败</td>
</tr>
</tbody>
</table>
<p>其中articles中的子项参数：</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>title</td>
<td>否</td>
<td>图文消息标题</td>
</tr>
<tr>
<td>desc</td>
<td>否</td>
<td>图文消息内容</td>
</tr>
<tr>
<td>imageUrl</td>
<td>否</td>
<td>图片链接，对于多条图文消息的第一条消息，该字段不能为空</td>
</tr>
<tr>
<td>url</td>
<td>否</td>
<td>点击图文消息跳转的链接</td>
</tr>
<tr>
<td>actionName</td>
<td>否</td>
<td>链接文字</td>
</tr>
<tr>
<td>authType</td>
<td>否</td>
<td>如果设置该字段且值为loginAuth时，则可以实现<a href="#c0503">网页授权获取用户基本信息</a>功能，实现免登、账号绑定等业务逻辑</td>
</tr>
</tbody>
</table>
<p><strong>注：其中title、desc、imageUrl不可同时为空</strong></p>
<p>开发者可以参考相关Demo（Demo包请<a href="#c1101_download">点此下载</a>）。</p>
<h3 id="c0401_response">同步响应结果</h3>
<pre><code>{
    &quot;alipay_mobile_public_message_custom_send_response&quot;: {
        &quot;code&quot;: 200,
        &quot;msg&quot;: &quot;成功&quot;
    },
    &quot;sign&quot;: &quot;N4xgzU4EfPguSbVF64129bFocaAS0UULmGmiYElFnB/qX+CZKCOhZbldrppRJgCtAku44ElEPoQTJR9VVf3HwnQmLb/QPzYP+4T5bb9ComI1kcRtfmmWxM1oEY1lfDI5G6tOAV6Tv5CXKi7c/pPjY5R/U2qLy5b+W8gW1X5g0gk=&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>是</td>
<td>返回码。处理成功：200；处理失败：请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>msg</td>
<td>是</td>
<td>支付宝返回的处理结果说明，请参考<a href="#c0901">返回码</a></td>
</tr>
</tbody>
</table>
<div id="alipay.mobile.public.message.total.send"></div><h2 id="c0402">群发消息</h2>
<h3 id="c0402_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.mobile.public.message.total.send</p>
<p>使用场景举例：开发者可以通过本接口向所有关注该服务窗用户发送消息。</p>
</blockquote>
<p>该接口可以发送以下2种消息：</p>
<ol>
<li>文本消息</li>
<li>图文消息</li>
</ol>
<h3 id="c0402_content">业务消息内容</h3>
<h4 id="c0402_text">文本消息</h4>
<pre><code>{
    &quot;msgType&quot;: &quot;text&quot;,
    &quot;text&quot;: {
        &quot;content&quot;: &quot;你好&quot;
    }
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>msgType</td>
<td>是</td>
<td>消息类型，text</td>
</tr>
<tr>
<td>content</td>
<td>是</td>
<td>文本消息内容</td>
</tr>
</tbody>
</table>
<p>开发者可以参考相关Demo（Demo包请<a href="#c1101_download">点此下载</a>）。</p>
<h4 id="c0402_article">图文消息</h4>
<p>单条图文消息示例：</p>
<pre><code>{
    &quot;msgType&quot;: &quot;image-text&quot;,
    &quot;createTime&quot;: 1406634435601,
    &quot;articles&quot;: [
        {
            &quot;actionName&quot;: &quot;立即查看&quot;,
            &quot;desc&quot;: &quot;图文内容&quot;,
            &quot;imageUrl&quot;: &quot;http: //example.com/abc.jpg&quot;,
            &quot;title&quot;: &quot;标题&quot;,
            &quot;url&quot;: &quot;https://www.example.com/a.php&quot;,
            &quot;authType&quot;: &quot;loginAuth&quot;
        }
    ]
}
</code></pre><p>多条图文消息示例：</p>
<pre><code>{
    &quot;msgType&quot;: &quot;image-text&quot;,
    &quot;createTime&quot;: 1406634435601,
    &quot;articles&quot;: [
        {
            &quot;actionName&quot;: &quot;立即查看&quot;,
            &quot;desc&quot;: &quot;图文内容&quot;,
            &quot;imageUrl&quot;: &quot;http: //example.com/abc.jpg&quot;,
            &quot;title&quot;: &quot;标题&quot;,
            &quot;url&quot;: &quot;https://www.example.com/a.php&quot;,
            &quot;authType&quot;: &quot;loginAuth&quot;
        },
        {
            &quot;actionName&quot;: &quot;查看余额&quot;,
            &quot;desc&quot;: &quot;图文内容&quot;,
            &quot;imageUrl&quot;: &quot;http: //example.com/efg.jpg&quot;,
            &quot;title&quot;: &quot;标题2&quot;,
            &quot;url&quot;: &quot;https://www.example.com/b.php&quot;,
            &quot;authType&quot;: &quot;loginAuth&quot;
        }
    ]
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>msgType</td>
<td>是</td>
<td>消息类型，image-text</td>
</tr>
<tr>
<td>createTime</td>
<td>是</td>
<td>消息创建时间</td>
</tr>
<tr>
<td>articles</td>
<td>是</td>
<td>图文消息子消息项集合，单条消息最多10个子项，否则会发送失败</td>
</tr>
</tbody>
</table>
<p>其中articles中的子项参数：</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>title</td>
<td>否</td>
<td>图文消息标题</td>
</tr>
<tr>
<td>desc</td>
<td>否</td>
<td>图文消息内容</td>
</tr>
<tr>
<td>imageUrl</td>
<td>否</td>
<td>图片链接，对于多条图文消息的第一条消息，该字段不能为空</td>
</tr>
<tr>
<td>url</td>
<td>否</td>
<td>点击图文消息跳转的链接</td>
</tr>
<tr>
<td>actionName</td>
<td>否</td>
<td>链接文字</td>
</tr>
<tr>
<td>authType</td>
<td>否</td>
<td>如果设置该字段且值为loginAuth时，则可以实现<a href="#c0503">网页授权获取用户基本信息</a>功能，实现免登、账号绑定等业务逻辑</td>
</tr>
</tbody>
</table>
<p><strong>注：其中title、desc、imageUrl不可同时为空</strong></p>
<p>开发者可以参考相关Demo（Demo包请<a href="#c1101_download">点此下载</a>）。</p>
<h3 id="c0402_response">同步响应结果</h3>
<pre><code>{
    &quot;alipay_mobile_public_message_total_send_response&quot;: {
        &quot;code&quot;: 200,
        &quot;msg&quot;: &quot;成功&quot;,
        &quot;data&quot;: &quot;20131211000555540edce750-b2d5-4d29-8cd1-0b423bf8df75&quot;
    },
    &quot;sign&quot;: &quot;Qour4B3uTa7XjFpzWxMtU0nzOF7UGBnXfVa5NcgN2eVAlkIJsKdgUpEtshGXVQ+CXE0JH4gZX/COLzlYEI5RdmPG3ez4K7cOGTr8zYt7YhvpBX5A+jWPJbjd/6LMdRL55oMDaealZQF/Rb8CpFlPHwyvyRGAoSm1M9UWzlsKTmA=&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>是</td>
<td>返回码。处理成功：200；处理失败：请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>msg</td>
<td>是</td>
<td>支付宝返回的处理结果说明，请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>data</td>
<td>否</td>
<td>消息ID</td>
</tr>
</tbody>
</table>
<h1 id="c05">用户管理</h1>
<div id="alipay.mobile.public.follow.list"></div><h2 id="c0501">获取关注者列表</h2>
<h3 id="c0501_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.mobile.public.follow.list</p>
<p>使用场景举例：开发者可通过本接口来获取帐号的关注者列表。</p>
</blockquote>
<p>关注者列表由一串用户OpenId组成。一次最多获取10000个关注者的OpenId，可以通过多次获取的方式来满足需求。</p>
<h3 id="c0501_content">业务消息内容</h3>
<pre><code>{
  &quot;nextUserId&quot;: &quot;aYMvrMC8+qdi3Mj1lqxRZJPUsrychFTewHXFVXq5ySDxWgIluiZN3K2r70Eebm4r01&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>nextUserId</td>
<td>当关注者数量超过10000时使用，本次拉取数据中第一个用户的OpenId，从上次接口调用返回值中获取，第一次调用置空</td>
</tr>
</tbody>
</table>
<h3 id="c0501_response">同步响应结果</h3>
<pre><code>{
    &quot;alipay_mobile_public_follow_list_response&quot;: {
        &quot;code&quot;: 200,
        &quot;count&quot;: &quot;2&quot;,
        &quot;data&quot;: {
            &quot;user_id_list&quot;: {
                &quot;string&quot;: [
                    &quot;ccQyL+73MAMTDkj2mRxLNkre8hjWnYClscK-vjUi4qOHCIhO5aJXi4frP7yHEJoJ01&quot;,
                    &quot;R8qtKrh1dS49uWaLZUbPr0re8hjWnYClscK-vjUi4qOHCIhO5aJXi4frP7yHEJoJ01&quot;
                ]
            }
        }
    },
    &quot;sign&quot;: &quot;b6AJP+rJLO0qExHKgYgHMsTwyRI5GhAUKmhuVAl+EmYW8Lic8kB9rgRpek0LeT3goHvEkimXv/BkUOYaVhIA7rrD8vQcNJDL7Vbgj3W3LToyB/biYWK8r1iHfYJNnOdstvq6FcU7xOOTSZHqFg45IHSc0vqXK9cqBeSgh2eJnoI=&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>sign</td>
<td>RSA加密签名</td>
</tr>
<tr>
<td>code</td>
<td>返回码。处理成功：200；处理失败：请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>count</td>
<td>本次调用获取的OpenId个数，最大值为10000</td>
</tr>
<tr>
<td>data</td>
<td>用户数据，包含OpenId列表</td>
</tr>
</tbody>
</table>
<div id="alipay.mobile.public.gis.get"></div><h2 id="c0502">获取用户地理位置</h2>
<h3 id="c0502_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.mobile.public.gis.get</p>
<p>使用场景举例：查询该用户当前的位置信息，可以根据用户位置完成不同的业务逻辑。</p>
</blockquote>
<h3 id="c0502_content">业务消息内容</h3>
<pre><code>{
    &quot;userId&quot;:&quot;m7DZN0VfcHYP6IRA1sP1gBuSX3JjLZtwilbxOzPGDUrbq9FV8CBamV+6ZPDwOg7401&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>userId</td>
<td>是</td>
<td>该用户的OpenId</td>
</tr>
</tbody>
</table>
<h3 id="c0502_response">同步响应结果</h3>
<pre><code>{
    &quot;alipay_mobile_public_gis_get_response&quot;: {
        &quot;accuracy&quot;: &quot;68.0&quot;,
        &quot;city&quot;: &quot;杭州市&quot;,
        &quot;code&quot;: 200,
        &quot;latitude&quot;: &quot;30.27283&quot;,
        &quot;longitude&quot;: &quot;120.12555&quot;,
        &quot;msg&quot;: &quot;成功&quot;,
        &quot;province&quot;: &quot;浙江省&quot;
    },
    &quot;sign&quot;: &quot;jfAz0Yi0OUvAPqYTzA0DLysx0ri++yf7o/lkHOHaG1Zy2fHBf3j4WM+sJWHZUuyInt6V+wn+6IP9AmwRTKi+GGdWjPrsfBjXqR7H5aBnLhMsAltV7v4cYjhuguAqh4WkaJO6v6CfdybDpzHlxE6Thoucnad+OsjdCXkNd1g3UuU=&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>是</td>
<td>返回码。处理成功：200；处理失败：请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>msg</td>
<td>是</td>
<td>支付宝返回的处理结果说明，请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>longitude</td>
<td>否</td>
<td>经度</td>
</tr>
<tr>
<td>latitude</td>
<td>否</td>
<td>维度</td>
</tr>
<tr>
<td>accuracy</td>
<td>否</td>
<td>精确度</td>
</tr>
<tr>
<td>province</td>
<td>否</td>
<td>省份，经纬度转换城市信息失败的情况会为空</td>
</tr>
<tr>
<td>city</td>
<td>否</td>
<td>城市，经纬度转换城市信息失败的情况会为空</td>
</tr>
</tbody>
</table>
<div id="alipay.user.userinfo.share"></div><h2 id="c0503">网页授权获取用户基本信息</h2>
<h3 id="c0503_intro">概述</h3>
<blockquote>
<p>如果用户在钱包中访问开发者的Web页面，开发者可以通过网页授权方式获取当前用户基本信息（包括姓名、性别、城市等）。利用用户信息，可以实现体验优化、用户来源统计、帐号绑定（免登）、用户身份鉴权等功能。网页授权基于OAuth2.0标准，是安全可靠的，关于OAuth2.0的详细介绍，可以参考OAuth2.0协议标准。 </p>
<p>网页授权大致分为三个步骤：</p>
<ul>
<li><strong>获取授权码：</strong>引导用户进入授权页面并同意授权，在此之后开发者可获取到auth_code；</li>
<li><strong>换取授权访问令牌：</strong>通过auth_code换取网页授权access_token，如果需要，开发者可以刷新网页授权access_token，避免过期；</li>
<li><strong>获取用户信息：</strong>通过access_token获取用户基本信息。</li>
</ul>
<p><strong>注意：</strong>在授权页面，用户如果不同意授权（点击取消按钮），也会跳转至开发者设定的页面，在url参数上<strong>不会</strong>带上auth_code，开发者需要在该页面进行容错处理。</p>
</blockquote>
<h3 id="c0503_get_auth">第一步：获取授权码</h3>
<p>当触发网页授权功能时，支付宝会在开发者的Web页面请求Url中加入参数，包括auth_code及app_id等，需要注意的是支付宝仅保证auth_code和app_id参数的有效性。支付宝请求开发者Web页面示例如下：</p>
<pre><code>http://example.com/doc/toAuthPage.html?auth_code=bb2e3e45c039475d8c27bdb376d179ee&amp;source=alipay_wallet&amp;ALIPAY_AUTH=publicp&amp;PUBLIC_ID=2014070100171523&amp;alipay_client_version=8.2.0.061818&amp;app_id=2014070100171523&amp;sourceId=publicplatform&amp;version=1.0
</code></pre><p>开发者可以使用菜单或者推送消息实现对某个链接配置网页授权的功能</p>
<ol>
<li><p>菜单配置：开发者使用创建菜单接口或者更新菜单接口，将某个菜单的actionType参数设置为&quot;link&quot;，同时将authType设置为loginAuth，其他参数详见<a href="#c0602">创建菜单</a></p>
<pre><code> {
     &quot;button&quot;: [{
         &quot;actionParam&quot;: &quot;http://example.com/b.php&quot;, 
         &quot;actionType&quot;: &quot;link&quot;, 
         &quot;authType&quot;: &quot;loginAuth&quot;,
         &quot;name&quot;: &quot;帐号绑定&quot;
     }]
 }
</code></pre></li>
<li><p>推送消息：开发者使用<a href="#c0401">异步单发消息</a>接口或者<a href="#c0402">群发消息</a>接口向用户推送消息时，将消息的authType设置为&quot;loginAuth&quot;</p>
<pre><code> {
     &quot;articles&quot;: [{
         &quot;actionName&quot;: &quot;立即查看&quot;,
         &quot;desc&quot;: &quot;图文内容&quot;,
         &quot;imageUrl&quot;: &quot;http: //example.com/abc.jpg&quot;,
         &quot;title&quot;: &quot;标题&quot;,
         &quot;url&quot;: &quot;https://www.alipay.com/&quot;,
         &quot;authType&quot;: &quot;loginAuth&quot;
     }],
     &quot;msgType&quot;: &quot;image-text&quot;,
     &quot;toUserId&quot;: &quot;R8qtKrh1dS49uWaLZUbPr0re8hjWnYClscK-vjUi4qOHCIhO5aJXi4frP7yHEJoJ01&quot;,
     &quot;createTime&quot;: 1406634435601
 }
</code></pre></li>
</ol>
<h3 id="c0503_get_token">第二步：换取授权访问令牌</h3>
<blockquote>
<p>接口名称：alipay.system.oauth.token</p>
<p>换取授权访问令牌，开发者可通过获取到的auth_code换取access_token。</p>
</blockquote>
<h4 id="c0503_auth_content">业务消息内容</h4>
<p>获取授权访问令牌的请求格式与<a href="#c0203">消息交互体系</a>中有所差别，grant_type、code以及refresh_token直接作为POST消息的参数，而不存在于biz_content参数之中，以下为一个请求的示例</p>
<pre><code>REQUEST URL: http://example.com/gateway.do
REQUEST METHOD: POST
CONTENT:
    app_id=2014070100171525
    method=alipay.system.oauth.token
    charset=GBK
    sign_type=RSA
    timestamp=2014-01-01 08:08:08
    sign=rXaTEfJ7WTDsP1DWRPHARW3uOr19+fzlngMCJBvbhP1XPEa9qZwGGng9oMDloABpJMT2SGeOj46+BUkqCGRO9fH90Vci3hOH01BfYnbhJz3ADK2h7gpjlponx4/sxELN6f2GXi51XKiHKnxMA9XpLLo68q+roY0M/ZFQ1UdnqeM=
    version=1.0
    grant_type=authorization_code
    code=4b203fe6c11548bcabd8da5bb087a83b
    refresh_token=201208134b203fe6c11548bcabd8da5bb087a83b
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>grant_type</td>
<td>是</td>
<td>授权类型，固定为authorization_code</td>
</tr>
<tr>
<td>code</td>
<td>是</td>
<td>授权码，用户对应用授权后得到，即第一步中开发者获取到auth_code值</td>
</tr>
<tr>
<td>refresh_token</td>
<td>否</td>
<td>可为空，刷新令牌时使用，失效时间300秒，上次换取得到的访问令牌</td>
</tr>
</tbody>
</table>
<h4 id="c0503_auth_response">同步响应结果</h4>
<pre><code>{
    &quot;alipay_system_oauth_token_response&quot;: {
        &quot;access_token&quot;: &quot;publicpBa869cad0990e4e17a57ecf7c5469a4b2&quot;,
        &quot;expires_in&quot;: 300,
        &quot;re_expires_in&quot;: 300,
        &quot;refresh_token&quot;: &quot;publicpB0ff17e364f0743c79b0b0d7f55e20bfc&quot;
    },
    &quot;sign&quot;: &quot;xDffQVBBelDiY/FdJi4/a2iQV1I7TgKDFf/9BUCe6+l1UB55YDOdlCAir8CGlTfa0zLYdX0UaYAa43zY2jLhCTDG+d6EjhCBWsNY74yTdiM95kTNsREgAt4PkOkpsbyZVXdLIShxLFAqI49GIv82J3YtzBcVDDdDeqFcUhfasII=&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>alipay_system_oauth_token_response</td>
<td>换取授权访问令牌内容</td>
</tr>
<tr>
<td>sign</td>
<td>RSA加密算法签名</td>
</tr>
<tr>
<td>access_token</td>
<td>交换令牌，换取用户信息的交换令牌</td>
</tr>
<tr>
<td>expires_in</td>
<td>令牌有效期，交换令牌的有效期，单位秒</td>
</tr>
<tr>
<td>re_expires_in</td>
<td>刷新令牌有效期，单位秒</td>
</tr>
<tr>
<td>refresh_token</td>
<td>刷新令牌时使用，失效时间300秒，上次换取得到的访问令牌</td>
</tr>
</tbody>
</table>
<h3 id="c0503_userinfo">第三步：获取用户信息</h3>
<blockquote>
<p>接口名称：alipay.user.userinfo.share</p>
<p>通过获取到的授权访问令牌，再调用此接口便可获取用户的基本信息。</p>
</blockquote>
<h4 id="c0503_userinfo_post">发送获取用户基本信息请求</h4>
<p>获取用户信息接口的POST消息格式与其他API参数略有不同，不含biz_content参数，多出了auth_token参数，格式如下：</p>
<pre><code>REQUEST URL: https://openapi.alipay.com/gateway.do
REQUEST METHOD: POST
CONTENT:
    method=alipay.user.userinfo.share
    timestamp=2014-07-29 20:30:30
    app_id=2014070100171523
    auth_token=publicpB9ea460ff5b5c468c9ccf5e967dc34963
    charset=GBK
    version=1.0
    sign_type=RSA
    sign=R48FPxFxDSzred4JQ+sLsjzzNen5eZVjVcOgepxBgNFwhIxn0XrqDR53Di6fv1nLMIGEDm0VyGq516J8sVj4rlUSLehHy+oN7s7m07dYk+6xHpoIz4A1+N2tlCmtiHslWGxF6KMEYVjZLHo/y7tEwHQJ6r4H1svT3CJJ2HJpK1o=
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>app_id</td>
<td>服务窗账号 ID，服务窗账号唯一标识</td>
</tr>
<tr>
<td>method</td>
<td>接口名称:alipay.user.userinfo.share</td>
</tr>
<tr>
<td>timestamp</td>
<td>发送请求的时间戳</td>
</tr>
<tr>
<td>sign_type</td>
<td>签名方式，目前只支持RSA</td>
</tr>
<tr>
<td>sign</td>
<td>RSA加密算法签名</td>
</tr>
<tr>
<td>auth_token</td>
<td>交换令牌，即通过换取授权访问令牌接口获取到的access_token参数值</td>
</tr>
</tbody>
</table>
<p>开发者可以参考相关Demo（Demo包请<a href="#c1101_download">点此下载</a>）。</p>
<h4 id="c0503_userinfo_response">同步响应结果</h4>
<p>当开发者发送获取用户基本信息请求后，支付宝会同步响应，参见如下示例：</p>
<p><strong>注：响应结果中的字段与开发者开通该接口时申请的权限有关，申请地址详见<a href="https://fuwu.alipay.com/platform/developerMode.htm">开发者模式-高级接口-账户信息共享</a></strong></p>
<pre><code>{
    &quot;alipay_user_userinfo_share_response&quot;: {
        &quot;user_type_value&quot;: &quot;2&quot;,
        &quot;is_licence_auth&quot;: &quot;F&quot;,
        &quot;is_certified&quot;: &quot;T&quot;,
        &quot;is_bank_auth&quot;: &quot;T&quot;,
        &quot;is_mobile_auth&quot;: &quot;F&quot;,
        &quot;user_id&quot;: &quot;ccQyL+73MAMTDkj2mRxLNkre8hjWnYClscK-vjUi4qOHCIhO5aJXi4frP7yHEJoJ01&quot;,
        &quot;user_status&quot;: &quot;T&quot;,
        &quot;is_id_auth&quot;: &quot;T&quot;
    },
    &quot;sign&quot;: &quot;P4iuFMEGKhQ6L+3Ako0Dpqc4QBksPiz/wbjGPaUIP0VTH8VEIViBbHWBT1VWxCqbvjugwbhoWrzfVcZXQC7McQKqCOC5b5O2yblpVuyLq2dIiqcMEZGammVHXeP1v4+kL4BX3/CTAPBTeSk+/zepipw0FeGMqpUPdoSPFl6ohUI=&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>用户的userId</td>
</tr>
<tr>
<td>user_type_value</td>
<td>用户类型（1/2） 1代表公司账户; 2代表个人账户</td>
</tr>
<tr>
<td>user_status</td>
<td>用户状态（Q/T/B/W）。 Q代表快速注册用户;T代表已认证用户;B代表被冻结账户;W代表已注册，未激活的账户</td>
</tr>
<tr>
<td>firm_name</td>
<td>公司名称（用户类型是公司类型时公司名称才有此字段）。</td>
</tr>
<tr>
<td>real_name</td>
<td>用户的真实姓名。</td>
</tr>
<tr>
<td>email</td>
<td>用户支付宝账号绑定的邮箱地址</td>
</tr>
<tr>
<td>avatar</td>
<td>用户头像</td>
</tr>
<tr>
<td>cert_no</td>
<td>证件号码</td>
</tr>
<tr>
<td>gender</td>
<td>性别（F：女性；M：男性）</td>
</tr>
<tr>
<td>phone</td>
<td>电话号码。</td>
</tr>
<tr>
<td>mobile</td>
<td>手机号码。</td>
</tr>
<tr>
<td>is_certified</td>
<td>是否通过实名认证。T是通过 F是没有实名认证</td>
</tr>
<tr>
<td>is_bank_auth</td>
<td>T为是银行卡认证，F为非银行卡认证。</td>
</tr>
<tr>
<td>is_id_auth</td>
<td>T为是身份证认证，F为非身份证认证。</td>
</tr>
<tr>
<td>is_mobile_auth</td>
<td>T为是手机认证，F为非手机认证。</td>
</tr>
<tr>
<td>is_licence_auth</td>
<td>T为通过营业执照认证，F为没有通过</td>
</tr>
<tr>
<td>cert_type_value</td>
<td>0:身份证;1:护照;2:军官证;3:士兵证;4:回乡证;5:临时身份证;6:户口簿;7:警官证;8:台胞证;9:营业执照;10其它证件</td>
</tr>
<tr>
<td>deliver_phone</td>
<td>收货地址的联系人固定电话。</td>
</tr>
<tr>
<td>deliver_mobile</td>
<td>收货地址的联系人移动电话。</td>
</tr>
<tr>
<td>deliver_fullname</td>
<td>收货人全称</td>
</tr>
<tr>
<td>province</td>
<td>省份名称。</td>
</tr>
<tr>
<td>city</td>
<td>市名称。</td>
</tr>
<tr>
<td>area</td>
<td>区县名称。</td>
</tr>
<tr>
<td>address</td>
<td>详细地址。</td>
</tr>
<tr>
<td>zip</td>
<td>邮政编码。</td>
</tr>
<tr>
<td>deliver_province</td>
<td>收货人所在省份</td>
</tr>
<tr>
<td>deliver_city</td>
<td>收货人所在城市</td>
</tr>
<tr>
<td>deliver_area</td>
<td>收货人所在区县</td>
</tr>
<tr>
<td>deliver_address_list</td>
<td>收货人地址列表，复杂类型</td>
</tr>
<tr>
<td>default_deliver_address</td>
<td>是否默认收货地址，暂时不返回值</td>
</tr>
<tr>
<td>address_code</td>
<td>区域编码，暂时不返回值</td>
</tr>
</tbody>
</table>
<p>其中deliver_address_list的参数列表如下：</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>deliver_fullname</td>
<td>收货人全名</td>
</tr>
<tr>
<td>default_deliver_address</td>
<td>是否默认收货地址</td>
</tr>
<tr>
<td>deliver_phone</td>
<td>收货地址的联系人固定电话</td>
</tr>
<tr>
<td>deliver_mobile</td>
<td>收货地址的联系人移动电话</td>
</tr>
<tr>
<td>address</td>
<td>地址</td>
</tr>
<tr>
<td>zip</td>
<td>邮政编码</td>
</tr>
<tr>
<td>deliver_province</td>
<td>收货人所在省份</td>
</tr>
<tr>
<td>deliver_city</td>
<td>收货人所在城市</td>
</tr>
<tr>
<td>deliver_area</td>
<td>收货人所在区县</td>
</tr>
<tr>
<td>address_code</td>
<td>区域编码</td>
</tr>
</tbody>
</table>
<h1 id="c06">自定义菜单</h1>
<h2 id="c0601">菜单规范</h2>
<h3 id="c0601_intro">简要说明</h3>
<ol>
<li>菜单创建后，在支付宝钱包客户端是实时生效的</li>
<li>删除原有菜单后，建议开发者至少保留该删除菜单的服务七天以上</li>
<li>最多设置4个一级菜单，每个一级菜单最多设置5个二级菜单，当设置4个一级菜单时，左侧的发送消息按钮将被隐藏</li>
<li>一级菜单最多显示4个汉字，二级菜单最多显示12个汉字</li>
</ol>
<h3 id="c0601_cate">菜单类型</h3>
<p>菜单总共分为以下两种类型：</p>
<ol>
<li>事件型菜单 - 用户点击之后支付宝网关向开发者网关发送<a href="#c0302">事件消息</a>，开发者可以通过自定义参数匹配的方式实现业务逻辑</li>
<li>链接型菜单 - 用户点击之后跳转到一个Web页面或者唤起一个本地服务（例如拨通电话），<strong>不向</strong>开发者网关发送消息</li>
</ol>
<h3 id="c0601_ifs">菜单接口</h3>
<p>服务窗平台提供三个接口，分别用于：</p>
<ol>
<li>创建菜单</li>
<li>更新菜单</li>
<li>查询菜单</li>
</ol>
<div id="alipay.mobile.public.menu.add"></div><h2 id="c0602">创建菜单</h2>
<h3 id="c0602_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.mobile.public.menu.add </p>
<p>使用场景举例：开发者通过调用该接口创建菜单。</p>
</blockquote>
<p>菜单只能被创建一次，后续的修改全部由更新菜单接口完成</p>
<h3 id="c0602_content">业务消息内容</h3>
<pre><code>{
    &quot;button&quot;: [
        {
            &quot;actionParam&quot;: &quot;ZFB_HFCZ&quot;, 
            &quot;actionType&quot;: &quot;out&quot;, 
            &quot;name&quot;: &quot;话费充值&quot;
        }, 
        {
            &quot;name&quot;: &quot;查询&quot;, 
            &quot;subButton&quot;: [
                {
                    &quot;actionParam&quot;: &quot;ZFB_YECX&quot;, 
                    &quot;actionType&quot;: &quot;out&quot;, 
                    &quot;name&quot;: &quot;余额查询&quot;
                }, 
                {
                    &quot;actionParam&quot;: &quot;95188&quot;, 
                    &quot;actionType&quot;: &quot;tel&quot;, 
                    &quot;name&quot;: &quot;联系我们&quot;
                }, 
                {
                    &quot;actionParam&quot;: &quot;http://example.com/a.php&quot;, 
                    &quot;actionType&quot;: &quot;link&quot;, 
                    &quot;name&quot;: &quot;话费查询&quot;
                }
            ]
        }, 
        {
            &quot;actionParam&quot;: &quot;http://example.com/b.php&quot;, 
            &quot;actionType&quot;: &quot;link&quot;, 
            &quot;authType&quot;: &quot;loginAuth&quot;,
            &quot;name&quot;: &quot;帐号绑定&quot;
        }
    ]
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>button</td>
<td>一级菜单数组，个数应为1~4个</td>
</tr>
<tr>
<td>subButton</td>
<td>二级菜单数组，个数应为1~5个</td>
</tr>
<tr>
<td>name</td>
<td>菜单标题，一级菜单不超过4个汉字，子菜单不超过12个汉字</td>
</tr>
<tr>
<td>actionType</td>
<td>菜单类型，out:事件型菜单；link:链接型菜单；tel:点击拨打电话</td>
</tr>
<tr>
<td>actionParam</td>
<td>当actionType为link时，该参数为详细链接；当actionType为out时，该参数为用户自定义参数；当actionType为tel时，该参数为电话号码。该参数最长255个字符，不允许冒号等特殊字符</td>
</tr>
<tr>
<td>authType</td>
<td>当actionType为link时，可以将该参数设为loginAuth实现免登，详见<a href="#c0503">网页授权获取用户基本信息</a></td>
</tr>
</tbody>
</table>
<h3 id="c0602_response">同步响应结果</h3>
<h4 id="c0602_suc">操作成功时的响应结果</h4>
<pre><code>{
    &quot;alipay_mobile_public_menu_add_response&quot;: {
        &quot;code&quot;: 200,
        &quot;msg&quot;: &quot;成功&quot;
    },
    &quot;sign&quot;: &quot;gi771WtMTPpLY68/jCibUyHZ1S6wbVFzD+E2ggH2TkwrJAl6tP2a/TyJIgxWrwnoYQfT6MEY3FwzC5x1jAhvb4l31fDKXfhi9iqfs87y4WT27rXRvvszXt5ILOkFLZ7NbZ1lZcZzPvL4fUf5qZLfsGlhzfkMUlThiMD8T+6VqVw=&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>返回码。处理成功：200；处理失败：请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>msg</td>
<td>支付宝返回的处理结果说明，请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>sign</td>
<td>RSA加密算法签名</td>
</tr>
</tbody>
</table>
<h4 id="c0602_error">操作失败时的响应结果示例</h4>
<pre><code>{
    &quot;alipay_mobile_public_menu_add_response&quot;: {
        &quot;code&quot;: 11013,
        &quot;msg&quot;: &quot;菜单已经创建过&quot;
    },
    &quot;sign&quot;: &quot;SFIJp0ZUTrjymCGTfLnfsGBh8objZgCEF1HsDvofpCjCZmTAnuuz/x8rRKiEEtnfipp0XHGpGRykMEzCvaJ6jt+FkAFiU0WCQAhXQFMX62tDCAqWu2RsKJVYeoJf1ApZESbIxAz0GE6WOwDFXQSHlCastLt30Lt4s9+vhiF7cHk=&quot;
}
</code></pre><div id="alipay.mobile.public.menu.update"></div><h2 id="c0603">更新菜单</h2>
<h3 id="c0603_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.mobile.public.menu.update</p>
<p>使用场景举例：开发者通过调用该接口更新菜单。</p>
</blockquote>
<h3 id="c0603_content">业务消息内容</h3>
<pre><code>{
    &quot;button&quot;: [
        {
            &quot;actionParam&quot;: &quot;ZFB_WDZH&quot;, 
            &quot;actionType&quot;: &quot;out&quot;, 
            &quot;name&quot;: &quot;我的账户&quot;
        }, 
        {
            &quot;name&quot;: &quot;查询&quot;, 
            &quot;subButton&quot;: [
                {
                    &quot;actionParam&quot;: &quot;ZFB_YECX&quot;, 
                    &quot;actionType&quot;: &quot;out&quot;, 
                    &quot;name&quot;: &quot;余额查询&quot;
                }, 
                {
                    &quot;actionParam&quot;: &quot;ZFB_LLCX&quot;, 
                    &quot;actionType&quot;: &quot;out&quot;, 
                    &quot;name&quot;: &quot;流量查询&quot;
                }
            ]
        }, 
        {
            &quot;actionParam&quot;: &quot;http://m.alipay.com&quot;, 
            &quot;actionType&quot;: &quot;link&quot;, 
            &quot;name&quot;: &quot;最新优惠&quot;
        }
    ]
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>button</td>
<td>一级菜单数组，个数应为1~4个</td>
</tr>
<tr>
<td>subButton</td>
<td>二级菜单数组，个数应为1~5个</td>
</tr>
<tr>
<td>name</td>
<td>菜单标题，一级菜单不超过4个汉字，子菜单不超过12个汉字</td>
</tr>
<tr>
<td>actionType</td>
<td>菜单类型，out:事件型菜单；link:链接型菜单；tel:点击拨打电话</td>
</tr>
<tr>
<td>actionParam</td>
<td>当actionType为link时，该参数为详细链接；当actionType为out时，该参数为用户自定义参数；当actionType为tel时，该参数为电话号码。该参数最长255个字符，不允许冒号等特殊字符</td>
</tr>
<tr>
<td>authType</td>
<td>当actionType为link时，可以将该参数设为loginAuth实现免登，详见<a href="#c0503">网页授权获取用户基本信息</a>，其他情况为空</td>
</tr>
</tbody>
</table>
<h3 id="c0603_response">同步响应结果</h3>
<h4 id="c0603_suc">操作成功时的响应结果</h4>
<pre><code>{
  &quot;alipay_mobile_public_menu_update_response&quot;: {
    &quot;code&quot;: 200,
    &quot;msg&quot;: &quot;成功&quot;
  },
  &quot;sign&quot;: &quot;gi771WtMTPpLY68/jCibUyHZ1S6wbVFzD+E2ggH2TkwrJAl6tP2a/TyJIgxWrwnoYQfT6MEY3FwzC5x1jAhvb4l31fDKXfhi9iqfs87y4WT27rXRvvszXt5ILOkFLZ7NbZ1lZcZzPvL4fUf5qZLfsGlhzfkMUlThiMD8T+6VqVw=&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>返回码。处理成功：200；处理失败：请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>msg</td>
<td>支付宝返回的处理结果说明，请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>sign</td>
<td>RSA加密算法签名</td>
</tr>
</tbody>
</table>
<h4 id="c0603_error">操作失败时的响应结果示例</h4>
<pre><code>{
    &quot;alipay_mobile_public_menu_update_response&quot;: {
        &quot;code&quot;: 11006,
        &quot;msg&quot;: &quot;二级菜单超出个数&quot;
    },
    &quot;sign&quot;: &quot;wwd3ofIpMD/eJIYhm3xTJgo4k1YvoW5JYInWxNJLVmqZ4ikTyZ90/KJCNN3PyquWyslego/6FSFj4D9TFRuGFSiTqQ0vnM0TT/wznn/8pKdC8cmmoZAIIAuyA/tnHoWYSt1cG/SsceF2pX87/TEL6rDY7xp36ha6D4SD4cpXxgA=&quot;
}
</code></pre><div id="alipay.mobile.public.menu.get"></div><h2 id="c0604">查询菜单</h2>
<h3 id="c0604_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.mobile.public.menu.get</p>
<p>使用场景举例：开发者通过调用该接口查询菜单。</p>
</blockquote>
<h3 id="c0604_content">业务消息内容</h3>
<pre><code>{
    // 注：业务参数为空
}
</code></pre><h3 id="c0604_response">同步响应结果</h3>
<h4 id="c0604_suc">操作成功时的响应结果</h4>
<pre><code>{
  &quot;alipay_mobile_public_menu_get_response&quot;: {
    &quot;code&quot;: 200,
    &quot;menu_content&quot;: &quot;{\&quot;button\&quot;:[{\&quot;actionParam\&quot;:\&quot;ZFB_HFCZ\&quot;,\&quot;actionType\&quot;:\&quot;out\&quot;,\&quot;name\&quot;:\&quot;话费充值\&quot;},{\&quot;name\&quot;:\&quot;查询\&quot;,\&quot;subButton\&quot;:[{\&quot;actionParam\&quot;:\&quot;ZFB_LLCX\&quot;,\&quot;actionType\&quot;:\&quot;out\&quot;,\&quot;name\&quot;:\&quot;流量查询\&quot;},{\&quot;actionParam\&quot;:\&quot;ZFB_HFCX\&quot;,\&quot;actionType\&quot;:\&quot;out\&quot;,\&quot;name\&quot;:\&quot;话费查询\&quot;}]},{\&quot;actionParam\&quot;:\&quot;http:\/\/m.alipay.com\&quot;,\&quot;actionType\&quot;:\&quot;link\&quot;,\&quot;name\&quot;:\&quot;最新优惠\&quot;}]}&quot;,
    &quot;msg&quot;: &quot;成功&quot;
  },
  &quot;sign&quot;: &quot;lwG5UXgud5EuKsJ2Y5DChoCBC8tm/Zbm9MZVNhmmwIZUqPHb8viAVYG2YIXWsh8+66TiVw9nJms/CVfVDztxLmUEtuQaCICUB8HZVkIgloDxf0ck80E5xzOX1iVEJwk/t9PvRhzMNi/I5BVou3yVEMeP2/gkBYzirIVoZJaRlGg=&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>返回码。处理成功：200；处理失败：请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>menu_content</td>
<td>菜单内容，<strong>数据类型为JSON类型字符串，需要再次解析</strong></td>
</tr>
<tr>
<td>sign</td>
<td>RSA加密算法签名</td>
</tr>
</tbody>
</table>
<p>menu_content解析为JSON后的格式如下：</p>
<pre><code>{
    &quot;button&quot;: [{
        &quot;actionParam&quot;: &quot;ZFB_HFCZ&quot;,
        &quot;actionType&quot;: &quot;out&quot;,
        &quot;name&quot;: &quot;话费充值&quot;
    }, {
        &quot;name&quot;: &quot;查询&quot;,
        &quot;subButton&quot;: [{
            &quot;actionParam&quot;: &quot;ZFB_YECX&quot;,
            &quot;actionType&quot;: &quot;out&quot;,
            &quot;name&quot;: &quot;余额查询&quot;
        }, {
            &quot;actionParam&quot;: &quot;ZFB_LLCX&quot;,
            &quot;actionType&quot;: &quot;out&quot;,
            &quot;name&quot;: &quot;流量查询&quot;
        }, {
            &quot;actionParam&quot;: &quot;ZFB_HFCX&quot;,
            &quot;actionType&quot;: &quot;out&quot;,
            &quot;name&quot;: &quot;话费查询&quot;
        }]
    }, {
        &quot;actionParam&quot;: &quot;http://m.alipay.com&quot;,
        &quot;actionType&quot;: &quot;link&quot;,
        &quot;name&quot;: &quot;最新优惠&quot;
    }]
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>button</td>
<td>一级菜单数组，个数应为1~4个</td>
</tr>
<tr>
<td>subButton</td>
<td>二级菜单数组，个数应为1~5个</td>
</tr>
<tr>
<td>name</td>
<td>菜单标题，一级菜单不超过4个汉字，子菜单不超过12个汉字</td>
</tr>
<tr>
<td>actionType</td>
<td>菜单类型，out:事件型菜单；link:链接型菜单；tel:点击拨打电话</td>
</tr>
<tr>
<td>actionParam</td>
<td>当actionType为link时，该参数为详细链接；当actionType为out时，该参数为用户自定义参数；当actionType为tel时，该参数为电话号码。该参数最长255个字符，不允许冒号等特殊字符</td>
</tr>
<tr>
<td>authType</td>
<td>当actionType为link时，可以将该参数设为loginAuth实现免登，详见<a href="#0503">网页授权获取用户基本信息</a></td>
</tr>
</tbody>
</table>
<h1 id="c07">推广支持</h1>
<div id="alipay.mobile.public.qrcode.create"></div><h2 id="c0701">带参推广二维码</h2>
<h3 id="c0701_intro">概述</h3>
<blockquote>
<p>接口名称：alipay.mobile.public.qrcode.create</p>
<p>使用场景举例：开发者通过调用该接口创建带参二维码。通过参数开发者可以区分二维码的渠道等信息。</p>
</blockquote>
<h3 id="c0701_content">业务消息内容</h3>
<pre><code>{
    &quot;codeInfo&quot;: {
        &quot;scene&quot;: {
            &quot;sceneId&quot;: &quot;1234&quot;
        }
    },
    &quot;codeType&quot;: &quot;TEMP&quot;,
    &quot;expireSecond&quot;: &quot;1800&quot;,
    &quot;showLogo&quot;: &quot;N&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>是否必须</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>codeType</td>
<td>是</td>
<td>二维码类型，目前只支持两种，TEMP：临时的(默认)；PERM：永久的</td>
</tr>
<tr>
<td>expireSecond</td>
<td>否</td>
<td>临时码过期时间，以秒为单位，最大不超过1800秒；永久码置空</td>
</tr>
<tr>
<td>codeInfo</td>
<td>否</td>
<td>开发者自定义信息</td>
</tr>
<tr>
<td>showLogo</td>
<td>否</td>
<td>二维码中间是否显示服务窗logo，Y：显示；N：不显示（默认）</td>
</tr>
<tr>
<td>sceneId</td>
<td>是</td>
<td>场景Id，最长32位，英文字母、数字以及下划线，开发者自定义</td>
</tr>
</tbody>
</table>
<p>注：当用户扫码时，支付宝网关会向开发者网关发送一条<a href="#c0302">进入消息</a>并且带有sceneId参数，开发者可以使用<a href="#c0401">异步发送消息</a>接口向该用户推送相应消息</p>
<p>开发者可以参考相关Demo（Demo包请<a href="#c1101_download">点此下载</a>）。</p>
<h3 id="c0701_response">同步响应结果</h3>
<h4 id="c0701_suc">操作成功时的响应结果</h4>
<pre><code>{
    &quot;alipay_mobile_public_qrcode_create_response&quot;: {
        &quot;code&quot;: 200,
        &quot;code_img&quot;: &quot;https://mobilecodec.alipay.com/show.htm?code=pvj4hi212zvdbk05bb&amp;picSize=M&quot;,
        &quot;expire_second&quot;: 1800,
        &quot;msg&quot;: &quot;成功&quot;
    },
    &quot;sign&quot;: &quot;enek+ijZYazyuAMJrcKCY/hejIi+SH0rMcoHN2aj7CIaxREzJZWh9GAkoQl8bHmg6T9BBnNbwHxc2OTJJeZFxDGp/4DIQBSn3ZCJ94nIzuBbP+7H3hk3cxOc61vQn79S8dy0ymKPUQpEmm8MiFsyxT9ABad1Jt89rBBL8toxlQY=&quot;
}
</code></pre><table>
<thead>
<tr>
<th>参数名</th>
<th>参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>返回码。处理成功：200；处理失败：请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>code_img</td>
<td>二维码图片地址，会经过跳转到实际图片</td>
</tr>
<tr>
<td>expire_second</td>
<td>二维码有效时间，单位（秒）。永久码暂时忽略该信息</td>
</tr>
<tr>
<td>msg</td>
<td>支付宝返回的处理结果说明，请参考<a href="#c0901">返回码</a></td>
</tr>
<tr>
<td>sign</td>
<td>RSA加密算法签名</td>
</tr>
</tbody>
</table>
<h4 id="c0701_error">操作失败时的响应结果示例</h4>
<pre><code>{
    &quot;alipay_mobile_public_qrcode_create_response&quot;: {
        &quot;code&quot;: 1001,
        &quot;msg&quot;: &quot;无效的业务参数&quot;
    },
    &quot;sign&quot;: &quot;lbRk3InUz2aIhQQOvk6BIRftEOACvDat6Tu/ZzbP9j2G7N6NYT8mRNQx7eHl0wYrtGSrqvc6i2gbmzny+WatLTKO9Zfe8hOP1Uzqh1dDlmfLaCV0Iniwncpue7sDBmPSUWvWTpioVscaB80rTrdbFwNBg32cSWY6sLtxckxg38c=&quot;
}
</code></pre><h1 id="c08">其他接口</h1>
<h2 id="c0801">支付接口</h2>
<h3 id="c0801_wap">手机网站支付</h3>
<p>手机网站支付主要应用于手机、掌上电脑等无线设备的网页上，通过网页跳转或浏览器自带的支付宝快捷支付实现买家付款的功能，资金即时到账。</p>
<p>申请条件：</p>
<ol>
<li>如果您有已经建设完成的无线网站（不包含淘宝网店、团购类网站），您的网站必须已通过ICP备案，备案信息与签约商户信息一致，网站经营的商品或服务内容明确、完整（古玩、珠宝等奢侈品、投资类行业无法申请本产品）；</li>
<li>如果您没有网站请提供应用demo（支持.apk.doc .docx .pdf格式）/或提供已经上线的应用名称，（appstore/豌豆荚/googleplay/91等应用市场上的应用名称，或已生效的服务窗名称；</li>
<li>您申请前必须拥有企业支付宝账号（不含个体工商户账号），且通过支付宝实名认证审核注册企业账号。</li>
</ol>
<p><a href="https://b.alipay.com/order/productDetail.htm?productId=2013080604609688">点击在线申请</a></p>
<h3 id="c0801_app">快捷支付(无线)</h3>
<p>快捷支付（无线）是一种程序式的支付方式，在手机、掌上电脑等无线设备的应用程序内，买家可通过支付宝进行付款购买特定服务或商品，资金即时到账。</p>
<p>申请条件：</p>
<ol>
<li>企业支付宝账号注册企业账号，您可以提供产品介绍文档或者手机demo.apk .doc .docx .pdf格式，内容要求包含产品说明、接口使用场景、资费说明等，文件大小不超过5M）如果已经在appstore、googleplay、豌豆荚上架，可不提供文档demo，直接提供应用名称，本产品不支持仅填写网址申请；</li>
<li>个体工商户，您可以提供产品介绍文档或者手机demo.apk .doc .docx .pdf格式，内容要求包含产品说明、接口使用场景、资费说明等，文件大小不超过5M）；个体工商户申请需要上传营业执照。</li>
</ol>
<p><a href="https://b.alipay.com/order/productDetail.htm?productId=2013080604609654">点击在线申请</a></p>
<div id="alipay.mobile.shake.user.query"></div><div id="alipay.pass.sync.add"></div><div id="alipay.pass.sync.update"></div><div id="alipay.pass.tpl.content.update"></div><div id="alipay.pass.tpl.content.add"></div><div id="alipay.pass.tpl.update"></div><div id="alipay.pass.tpl.add"></div><div id="alipay.pass.file.add"></div><h2 id="c0802">卡券接口</h2>
<p>卡券接口文档正在完善中，老接口文档查看请<a href="https://openhome.alipay.com/doc/docIndex.htm?url=https://openhome.alipay.com/doc/viewKbDoc.htm?key=236698&amp;type=cat">点此查看</a></p>
<h1 id="c09">附录</h1>
<h2 id="c0901">返回码</h2>
<h3 id="c0901_biz">业务返回码</h3>
<table>
<thead>
<tr>
<th>返回码</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>200</td>
<td>成功</td>
</tr>
<tr>
<td>403</td>
<td>服务不可用</td>
</tr>
<tr>
<td>503</td>
<td>系统错误</td>
</tr>
<tr>
<td>1001</td>
<td>无效的业务参数</td>
</tr>
<tr>
<td>1002</td>
<td>无效的业务行为</td>
</tr>
<tr>
<td>1003</td>
<td>解析XML/JSON出错</td>
</tr>
<tr>
<td>2001</td>
<td>服务窗账号信息不存在</td>
</tr>
<tr>
<td>2002</td>
<td>服务窗账号暂不能提供服务</td>
</tr>
<tr>
<td>2003</td>
<td>支付宝账号信息不存在</td>
</tr>
<tr>
<td>2004</td>
<td>无效的用户userId</td>
</tr>
<tr>
<td>2005</td>
<td>无效的手机号mobileNo</td>
</tr>
<tr>
<td>2006</td>
<td>无效的身份证号码identityCard</td>
</tr>
<tr>
<td>10001</td>
<td>绑定账户解析格式错误</td>
</tr>
<tr>
<td>10002</td>
<td>关注者fromUserId不能为空</td>
</tr>
<tr>
<td>10003</td>
<td>agreementId不能为空</td>
</tr>
<tr>
<td>10004</td>
<td>绑定账户不能为空</td>
</tr>
<tr>
<td>10005</td>
<td>displayName为空</td>
</tr>
<tr>
<td>10006</td>
<td>displayName超出长度</td>
</tr>
<tr>
<td>10007</td>
<td>realName超出长度</td>
</tr>
<tr>
<td>10008</td>
<td>协议号已被占用</td>
</tr>
<tr>
<td>10009</td>
<td>协议号无效</td>
</tr>
<tr>
<td>10010</td>
<td>协议号已被废弃</td>
</tr>
<tr>
<td>10011</td>
<td>添加外部户业务中的服务窗帐号与消息头服务窗帐号不一致</td>
</tr>
<tr>
<td>10012</td>
<td>重复添加账户</td>
</tr>
<tr>
<td>10013</td>
<td>您添加的账户已达上限</td>
</tr>
<tr>
<td>10014</td>
<td>添加绑定账户失败</td>
</tr>
<tr>
<td>10015</td>
<td>移除绑定账户失败</td>
</tr>
<tr>
<td>10016</td>
<td>禁止移除其它服务窗帐号的绑定账户</td>
</tr>
<tr>
<td>10017</td>
<td>禁止移除其它支付宝用户的绑定账户</td>
</tr>
<tr>
<td>10018</td>
<td>新绑定的户号与要删除的老绑定账户的户号一样,不能换绑</td>
</tr>
<tr>
<td>10019</td>
<td>移除外部户时参数信息不够:agreementId为空时，bindAccountNo和fromUserId均不能为空</td>
</tr>
<tr>
<td>10020</td>
<td>根据bindAccountNo、fromUserId和appId查不到对应的外部账号</td>
</tr>
<tr>
<td>10021</td>
<td>禁止查询非关注用户的绑定账户列表</td>
</tr>
<tr>
<td>10022</td>
<td>请求的支付宝用户Id无效</td>
</tr>
<tr>
<td>11001</td>
<td>菜单解析格式错误</td>
</tr>
<tr>
<td>11002</td>
<td>菜单没有内容</td>
</tr>
<tr>
<td>11003</td>
<td>一级菜单标题超出长度</td>
</tr>
<tr>
<td>11004</td>
<td>二级菜单标题超出长度</td>
</tr>
<tr>
<td>11005</td>
<td>一级菜单超出个数</td>
</tr>
<tr>
<td>11006</td>
<td>二级菜单超出个数</td>
</tr>
<tr>
<td>11007</td>
<td>菜单标题为空</td>
</tr>
<tr>
<td>11008</td>
<td>菜单超出2级</td>
</tr>
<tr>
<td>11009</td>
<td>菜单标题为空</td>
</tr>
<tr>
<td>11010</td>
<td>菜单type不在支持范围内</td>
</tr>
<tr>
<td>11011</td>
<td>无效的关注关系</td>
</tr>
<tr>
<td>11012</td>
<td>推送消息失败</td>
</tr>
<tr>
<td>11013</td>
<td>菜单已经创建过</td>
</tr>
<tr>
<td>11014</td>
<td>菜单actionParam不能为空</td>
</tr>
<tr>
<td>11015</td>
<td>菜单authType非法</td>
</tr>
<tr>
<td>11016</td>
<td>菜单中含有未授权的菜单类型</td>
</tr>
<tr>
<td>11017</td>
<td>菜单中含有非法字符或链接,请检查</td>
</tr>
<tr>
<td>12001</td>
<td>服务窗帐号与消息体内不一致</td>
</tr>
<tr>
<td>12002</td>
<td>消息中含有非法字符或者链接，请检查</td>
</tr>
<tr>
<td>12003</td>
<td>服务窗帐号已经下线,发送消息失败</td>
</tr>
<tr>
<td>12004</td>
<td>批量发送消息频率超限</td>
</tr>
<tr>
<td>12005</td>
<td>使用了已经发送过的分组ID标识</td>
</tr>
<tr>
<td>12006</td>
<td>单发消息频率超限</td>
</tr>
<tr>
<td>12007</td>
<td>没有关注者，发送消息失败</td>
</tr>
<tr>
<td>12008</td>
<td>绑定账户不存在</td>
</tr>
<tr>
<td>12020</td>
<td>消息模板不存在</td>
</tr>
<tr>
<td>12021</td>
<td>消息模板未启用</td>
</tr>
<tr>
<td>12022</td>
<td>无效的消息模板标识templateId</td>
</tr>
<tr>
<td>12023</td>
<td>无效的消息模板内容template</td>
</tr>
<tr>
<td>12024</td>
<td>无效的消息模板KEY，和预设变量KEY冲突</td>
</tr>
<tr>
<td>12025</td>
<td>无效的匹配器matcher</td>
</tr>
<tr>
<td>12026</td>
<td>模板上下文context缺少相关的变量KEY</td>
</tr>
<tr>
<td>12030</td>
<td>用户拒绝接受该服务窗消息</td>
</tr>
<tr>
<td>12031</td>
<td>用户没有行为，发送消息失败</td>
</tr>
<tr>
<td>12035</td>
<td>消息类型非法</td>
</tr>
<tr>
<td>13001</td>
<td>查询用户地理位置信息失败</td>
</tr>
<tr>
<td>13002</td>
<td>服务窗帐号没有查询用户地理位置信息的权限</td>
</tr>
<tr>
<td>13003</td>
<td>禁止查询非关注用户的地理位置信息</td>
</tr>
<tr>
<td>13004</td>
<td>用户地理位置信息不存在</td>
</tr>
<tr>
<td>14001</td>
<td>无效的userId</td>
</tr>
<tr>
<td>14002</td>
<td>系统繁忙,请稍候再次获取</td>
</tr>
<tr>
<td>14004</td>
<td>添加关注失败</td>
</tr>
<tr>
<td>14005</td>
<td>没有添加关注的权限</td>
</tr>
</tbody>
</table>
<h3 id="c0901_security">安全机制错误码</h3>
<p>当商户通过接口请求支付宝，支付宝同步返回参数时，如果支付宝在安全机制环节校验不通过，则返回安全机制异常参数信息，而不会返回本文档中其他章节的同步返回参数。</p>
<p>安全机制异常同步返回参数列表如下：</p>
<table>
<thead>
<tr>
<th>code（错误代码）</th>
<th>msg（错误代码描述）</th>
<th>sub_code（明细错误码）</th>
<th>sub_msg（明细错误码描述）</th>
</tr>
</thead>
<tbody>
<tr>
<td>40001</td>
<td>Missing Required Arguments</td>
<td>isv.missing-method</td>
<td>缺少方法名参数</td>
</tr>
<tr>
<td>40002</td>
<td>Invalid Arguments</td>
<td>isv.invalid-method</td>
<td>不存在的方法名</td>
</tr>
<tr>
<td>40002</td>
<td>Invalid Arguments</td>
<td>isv.invalid-format</td>
<td>无效数据格式</td>
</tr>
<tr>
<td>40001</td>
<td>Missing Required Arguments</td>
<td>isv.missing-signature</td>
<td>缺少签名参数</td>
</tr>
<tr>
<td>40001</td>
<td>Missing Required Arguments</td>
<td>isv.missing-signature-type</td>
<td>缺少签名类型参数</td>
</tr>
<tr>
<td>40001</td>
<td>Missing Required Arguments</td>
<td>isv.missing-signature-key</td>
<td>缺少签名配置（未提供公钥）</td>
</tr>
<tr>
<td>40002</td>
<td>Invalid Arguments</td>
<td>isv.invalid-signature</td>
<td>无效签名</td>
</tr>
<tr>
<td>40002</td>
<td>Invalid Arguments</td>
<td>isv.invalid-signature-type</td>
<td>无效签名类型</td>
</tr>
<tr>
<td>40001</td>
<td>Missing Required Arguments</td>
<td>isv.missing-app-id</td>
<td>缺少AppID参数</td>
</tr>
<tr>
<td>40002</td>
<td>Invalid Arguments</td>
<td>isv.invalid-app-id</td>
<td>无效的AppID参数</td>
</tr>
<tr>
<td>40001</td>
<td>Missing Required Arguments</td>
<td>isv.missing-timestamp</td>
<td>缺少时间戳参数</td>
</tr>
<tr>
<td>40002</td>
<td>Invalid Arguments</td>
<td>isv.invalid-timestamp</td>
<td>非法的时间戳参数</td>
</tr>
<tr>
<td>40002</td>
<td>Invalid Arguments</td>
<td>Isv.invalid-charset</td>
<td>字符集错误</td>
</tr>
<tr>
<td>40003</td>
<td>invalid-app-state</td>
<td>Isv.invalid-app-state</td>
<td>应用状态不满足条件</td>
</tr>
<tr>
<td>20001</td>
<td>Insufficient Token Permissions</td>
<td>invalid-auth-token</td>
<td>无效的访问令牌</td>
</tr>
<tr>
<td>20001</td>
<td>Insufficient Token Permissions</td>
<td>aop.auth-token-time-out</td>
<td>访问令牌已过期</td>
</tr>
<tr>
<td>20000</td>
<td>Service Currently Unavailable</td>
<td>aop.unknow-error</td>
<td>系统繁忙</td>
</tr>
<tr>
<td>20000</td>
<td>Service Currently Unavailable</td>
<td>isp.unknow-error</td>
<td>系统繁忙</td>
</tr>
</tbody>
</table>
<h1 id="c10">JS接口</h1>
<table>
<thead>
<tr>
<th>接口名称</th>
<th>接口说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#alipayjsbridgeready">AlipayJSBridgeReady</a></td>
<td>JSBridge ready事件</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#resume">resume</a></td>
<td>当一个webview界面重新回到栈顶时触发该事件</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#back-后退">back</a></td>
<td>点击底部工具栏或者安卓回退按钮触发该事件</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#checkjsapi-jsapi可用性判断">checkJSAPI</a></td>
<td>JSApi可用性判断</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#checkapp-钱包内app可用性判断">checkApp</a></td>
<td>钱包内App（比如余额宝、转账等）可用性判断</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#isinstalledapp-外部应用存在性判断">isInstalledApp</a></td>
<td>检测外部App是否安装，比如淘宝主客</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#optionmenu">optionMenu</a></td>
<td>点击顶部标题栏右方按钮触发该事件</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#toolbarmenuclick">toolbarMenuClick</a></td>
<td>点击顶部标题栏菜单触发该事件</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#titleclick">titleClick</a></td>
<td>点击顶部标题栏标题触发该事件</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#subtitleclick">subtitleClick</a></td>
<td>点击顶部标题栏副标题触发该事件</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#titlebar-控制标题栏">titlebar</a></td>
<td>显示/隐藏顶部标题栏（默认隐藏），设置标题等操作</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#toolbar-设置工具栏">toolbar</a></td>
<td>显示/隐藏底部工具栏</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#toast-弱提示">toast</a></td>
<td>弹出Toast提示</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#settoolbarmenu-设置菜单项">setToolbarMenu</a></td>
<td>设置底部工具栏菜单项自定义选项</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#alert-对话框">Alert</a></td>
<td>弹出对话框</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#confirm-选择对话框">Confirm</a></td>
<td>弹出选择对话框</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#loading-加载中提示">loading</a></td>
<td>弹出加载中提示</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#popto-退回指定界面">popTo</a></td>
<td>退回指定会话界面栈中的某个界面</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#exitapp-退出当前h5应用">exitApp</a></td>
<td>退出当前所有WebView</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#openinbrowser-浏览器中打开">openInBrowser</a></td>
<td>浏览器中打开</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#窗口控制">窗口控制</a></td>
<td>打开/关闭WebView</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#getnetworktype-获取网络状态">getNetworkType</a></td>
<td>获取用户网络状态，wifi或者非wifi</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#photo-拍照/选择照片">photo</a></td>
<td>拍照/选择照片</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#share-分享">share</a></td>
<td>调用系统分享组件</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#getcities-城市选择">getCities</a></td>
<td>调用Native的选择城市组件</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#vibrate-调用震动">vibrate</a></td>
<td>调用震动</td>
</tr>
<tr>
<td><a href="http://am-team.github.io/h5container/jsapi-doc.html#watchshake-摇一摇">watchShake</a></td>
<td>摇一摇</td>
</tr>
</tbody>
</table>
<h1 id="c11">开发者工具</h1>
<h2 id="c1101">SDK与Demo</h2>
<h3 id="c1101_intro">概述</h3>
<p>建议开发者使用支付宝提供的SDK进行服务窗开发，使用SDK进行开发有以下优点：</p>
<ol>
<li>SDK会随着新接口的发布而同步更新</li>
<li>SDK会随着老接口的更新而同步更新</li>
<li>SDK让底层逻辑变得透明和简单，开发者只需关注于自身的业务逻辑</li>
<li>SDK集成了编码、签名等常用方法，开发者无需额外耗费时间</li>
<li>提供了基于SDK开发的Demo，开发者上手更容易</li>
</ol>
<p>目前提供了Java版本的Demo（包括JDK 1.4和JDK 1.5），PHP和.NET2010的Demo正在开发和完善中，敬请期待。Demo包含以下几类业务场景：</p>
<ol>
<li>接入与验证示例</li>
<li>同步回复消息示例</li>
<li>关注事件示例</li>
<li>取消关注事件示例</li>
<li>普通进入事件示例</li>
<li>文本消息事件示例</li>
<li>文本消息事件示例</li>
<li>异步单发文本消息示例（以回复菜单点击事件为例）</li>
<li>异步单发图文消息示例</li>
<li>异步单发图文消息（含免登功能）示例</li>
<li>群发文本消息示例</li>
<li>群发图文消息示例</li>
<li>网页授权获取用户信息示例</li>
<li>带参二维码进入事件示例</li>
</ol>
<h3 id="c1101_download">下载链接</h3>
<p>SDK下载：</p>
<ol>
<li><a href="http://openhome.alipay.com/doc/sdkDownload.resource?sdkType=JAVA">Java-JDK 1.5 SDK</a></li>
<li><a href="http://openhome.alipay.com/doc/sdkDownload.resource?sdkType=JDK14">Java-JDK 1.4 SDK</a></li>
<li><a href="http://openhome.alipay.com/doc/sdkDownload.resource?sdkType=PHP">PHP SDK</a></li>
<li><a href="http://openhome.alipay.com/doc/sdkDownload.resource?sdkType=NET">.NET2010 SDK</a></li>
</ol>
<p>Demo下载：</p>
<ol>
<li><a href="https://i.alipayobjects.com/i/ecmng/zip/201408/Alipay Fuwuchuang Java JDK 1.5 Demo.zip">Java-JDK 1.5 Demo</a></li>
<li><a href="https://i.alipayobjects.com/i/ecmng/zip/201408/Alipay Fuwuchuang Java JDK 1.4 Demo.zip">Java-JDK 1.4 Demo</a></li>
<li><a href="https://i.alipayobjects.com/i/ecmng/zip/201408/Alipay Fuwuchuang PHP Demo.zip">PHP Demo</a></li>
<li><a href="https://i.alipayobjects.com/i/ecmng/zip/201408/Alipay Fuwuchuang DotNet Demo.zip">.NET2010 Demo</a></li>
</ol>
